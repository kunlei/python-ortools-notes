<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.306">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Hands-on Optimization with OR-Tools in Python - 6&nbsp; Traveling Salesman Problem</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ip-cvrp.html" rel="next">
<link href="./ip-jsp.html" rel="prev">
<link href="./logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DTVHQH448R"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-DTVHQH448R', { 'anonymize_ip': true});
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: { equationNumbers: {autoNumber: "AMS"} },
        tex2jax: {inlineMath: [ ['$','$'], ["\\(","\\)"] ]}
    });
    </script>

<!-- This is what works with Quarto -->
<script>
    MathJax = {
        tex: {
            tags: 'ams'  // should be 'ams', 'none', or 'all'
        }
    };
</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="twitter:title" content="Hands-on Optimization with OR-Tools in Python - 6&nbsp; Traveling Salesman Problem">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://kunlei.github.io/python-ortools-notes/ip-tsp_files/figure-html/fig-tsp-ulysses22-sol-output-1.png">
<meta name="twitter:image-height" content="790">
<meta name="twitter:image-width" content="1182">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./linear-programming.html">Mathematical Programming</a></li><li class="breadcrumb-item"><a href="./ip-tsp.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Traveling Salesman Problem</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Hands-on Optimization with OR-Tools in Python</a> 
        <div class="sidebar-tools-main">
    <a href="https://twitter.com/intent/tweet?url=|url|" title="Twitter" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">For the Impatient</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./env-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environment Setup</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Mathematical Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linear-programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./integer-programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Integer Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ip-jsp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Job Shop Scheduling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ip-tsp.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Traveling Salesman Problem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ip-cvrp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Capacitated Vehicle Routing Problem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./column-generation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Column Generation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Constraint Programming</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Tailored Algorithms</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#tsp-instances" id="toc-tsp-instances" class="nav-link active" data-scroll-target="#tsp-instances"><span class="header-section-number">6.1</span> TSP Instances</a>
  <ul class="collapse">
  <li><a href="#tsplib" id="toc-tsplib" class="nav-link" data-scroll-target="#tsplib"><span class="header-section-number">6.1.1</span> TSPLIB</a></li>
  <li><a href="#visualize-tsp-solution" id="toc-visualize-tsp-solution" class="nav-link" data-scroll-target="#visualize-tsp-solution"><span class="header-section-number">6.1.2</span> Visualize TSP Solution</a></li>
  </ul></li>
  <li><a href="#problem-description" id="toc-problem-description" class="nav-link" data-scroll-target="#problem-description"><span class="header-section-number">6.2</span> Problem Description</a></li>
  <li><a href="#model-1---dfj" id="toc-model-1---dfj" class="nav-link" data-scroll-target="#model-1---dfj"><span class="header-section-number">6.3</span> Model 1 - DFJ</a></li>
  <li><a href="#model-2---mtz" id="toc-model-2---mtz" class="nav-link" data-scroll-target="#model-2---mtz"><span class="header-section-number">6.4</span> Model 2 - MTZ</a></li>
  <li><a href="#model-3---single-commodity-flow" id="toc-model-3---single-commodity-flow" class="nav-link" data-scroll-target="#model-3---single-commodity-flow"><span class="header-section-number">6.5</span> Model 3 - Single Commodity Flow</a></li>
  <li><a href="#model-4---two-commodity-flow" id="toc-model-4---two-commodity-flow" class="nav-link" data-scroll-target="#model-4---two-commodity-flow"><span class="header-section-number">6.6</span> Model 4 - Two Commodity Flow</a></li>
  <li><a href="#model-5---multi-commodity-flow" id="toc-model-5---multi-commodity-flow" class="nav-link" data-scroll-target="#model-5---multi-commodity-flow"><span class="header-section-number">6.7</span> Model 5 - Multi-Commodity Flow</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-ip-tsp" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Traveling Salesman Problem</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The traveling salesman problem (TSP) is a classic optimization problem in computer science and operations research. The problem can be stated as follows: given a set of cities and the distances between them, what is the shortest possible route that visits each city exactly once and returns to the starting city?</p>
<p>The TSP has many real-world applications, including logistics and transportation planning, circuit board drilling, and DNA sequencing. However, it is a well-known NP-hard problem, meaning that finding an optimal solution is computationally difficult for large instances of the problem. As a result, many heuristic and approximation algorithms have been developed to find suboptimal solutions that are still very good in practice. In this chapter, we present several mathematical formulations of the TSP existing in the literature and implement them using OR-Tools.</p>
<section id="tsp-instances" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="tsp-instances"><span class="header-section-number">6.1</span> TSP Instances</h2>
<p>Before discussing the mathematical models of the TSP, we first provide an introduction to the instances that will be utilized to test various formulations and illustrate the resulting TSP solutions. The TSP is a widely recognized optimization problem that has been studied for several decades. Due to its significance, many benchmarking problem instances of varying sizes are available in literature. In this chapter, we do not aim to solve the most challenging TSP instances, but instead, our objective is to demonstrate how to apply different formulations of the TSP using OR-Tools.</p>
<p>To achieve this objective, we will focus on presenting some of the small-sized instances that can be solved effectively using OR-Tools. These instances are well-documented, which makes them easy to understand and implement in practice. Additionally, they help illustrate the optimization techniques used to solve the TSP, such as branch-and-bound and cutting plane methods. Moreover, small-sized instances allow for quicker computation, making it easier to observe the behavior of different algorithms and identify which formulations are most efficient.</p>
<p>By presenting a range of examples, we aim to provide a clear understanding of how to implement different TSP formulations using OR-Tools, which can be applied to real-world problems in various domains, such as transportation planning and logistics, network design, and circuit board drilling. Additionally, we aim to demonstrate the advantages and limitations of different TSP formulations and algorithms, highlighting which techniques perform well under specific circumstances. By doing so, readers can gain insight into how to apply TSP optimization techniques to their own problems effectively.</p>
<section id="tsplib" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="tsplib"><span class="header-section-number">6.1.1</span> TSPLIB</h3>
<p>The TSP instances used in this section are sourced from <a href="http://comopt.ifi.uni-heidelberg.de/software/TSPLIB95/">TSPLIB95</a>, a library of TSP benchmark instances. To make it easier to work with these instances, we utilize the <code>tsplib95</code> Python library, which can be installed using the <code>pip install tsplib95</code> command.</p>
<p>In the code snippet below, we demonstrate how to use the <code>tsplib95</code> package to load the <em>ulysses22.tsp</em> problem from a data file downloaded from TSPLIB95. The loaded data can be used to formulate and solve TSP instances using OR-Tools or other optimization tools. The full instance data is provided at the end for reference. By leveraging the <code>tsplib95</code> package, we can quickly and easily access TSP instances for experimentation and analysis, and focus our efforts on the formulation and optimization aspects of the problem.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> tsplib95</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># load problem</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>problem <span class="op">=</span> tsplib95.load(<span class="st">'./data/tsp/ulysses22.tsp'</span>)</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co"># show instance</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>problem.as_name_dict()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>{'name': 'ulysses22.tsp',
 'comment': 'Odyssey of Ulysses (Groetschel/Padberg)',
 'type': 'TSP',
 'dimension': 22,
 'edge_weight_type': 'GEO',
 'display_data_type': 'COORD_DISPLAY',
 'node_coords': {1: [38.24, 20.42],
  2: [39.57, 26.15],
  3: [40.56, 25.32],
  4: [36.26, 23.12],
  5: [33.48, 10.54],
  6: [37.56, 12.19],
  7: [38.42, 13.11],
  8: [37.52, 20.44],
  9: [41.23, 9.1],
  10: [41.17, 13.05],
  11: [36.08, -5.21],
  12: [38.47, 15.13],
  13: [38.15, 15.35],
  14: [37.51, 15.17],
  15: [35.49, 14.32],
  16: [39.36, 19.56],
  17: [38.09, 24.36],
  18: [36.09, 23.0],
  19: [40.44, 13.57],
  20: [40.33, 14.15],
  21: [40.37, 14.23],
  22: [37.57, 22.56]}}</code></pre>
</div>
</div>
<p>The list of nodes can be retrieved using the <code>get_nodes()</code> function, as shown below.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="bu">list</span>(problem.get_nodes())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22]</code></pre>
</div>
</div>
<p>To get the distance between any pair of nodes, we use the <code>get_weight()</code> function.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="bu">print</span>(<span class="ss">f'distance between node 1 and 2 = </span><span class="sc">{</span>problem<span class="sc">.</span>get_weight(<span class="dv">1</span>, <span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>distance between node 1 and 2 = 509</code></pre>
</div>
</div>
</section>
<section id="visualize-tsp-solution" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="visualize-tsp-solution"><span class="header-section-number">6.1.2</span> Visualize TSP Solution</h3>
<p>In this section, our goal is to gain a better understanding of the TSP problem by visualizing the optimal solution found for instances provided by TSPLIB95. To achieve this, we define a class called <code>TspVisualizer</code> in our code that is responsible for displaying the route that connects all nodes in a TSP solution. The <code>TspVisualizer</code> class contains a single function, called <code>show(locations, edges)</code>, which accepts two input parameters: <em>locations</em> and <em>edges</em>.</p>
<p>The <em>locations</em> parameter is a dictionary that contains the mapping between location ID and its corresponding coordinates. The <em>edges</em> parameter is a list of edges that form the TSP tour. By calling the show function with the appropriate input parameters, we can visualize the TSP tour and gain an intuitive understanding of what the TSP problem is trying to accomplish. This visualization can be a helpful tool in understanding how the different TSP formulations and algorithms work, and can aid in identifying potential improvements to the solution. The use of the <code>TspVisualizer</code> class allows for easy visualization of the TSP solution and makes it possible to explore and analyze TSP instances in a more meaningful way.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="kw">class</span> TspVisualizer:</span>
<span id="cb7-7"><a href="#cb7-7"></a>    <span class="co">"""visualize a TSP tour</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">    """</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>    </span>
<span id="cb7-10"><a href="#cb7-10"></a>    <span class="at">@staticmethod</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>    <span class="kw">def</span> show(locations, edges):</span>
<span id="cb7-12"><a href="#cb7-12"></a>        <span class="co">"""draw TSP tour</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">        adapted from https://stackoverflow.com/a/50682819</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">        </span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">        examples:</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">        locations = {</span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">            0: (5, 5),</span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">            1: (4, 9),</span></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="co">            2: (6, 4),</span></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co">        }</span></span>
<span id="cb7-21"><a href="#cb7-21"></a></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="co">        edges = [</span></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="co">            (0, 1),</span></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="co">            (1, 2),</span></span>
<span id="cb7-25"><a href="#cb7-25"></a><span class="co">            (2, 0),</span></span>
<span id="cb7-26"><a href="#cb7-26"></a><span class="co">        ]</span></span>
<span id="cb7-27"><a href="#cb7-27"></a></span>
<span id="cb7-28"><a href="#cb7-28"></a><span class="co">        Args:</span></span>
<span id="cb7-29"><a href="#cb7-29"></a><span class="co">            locations (dict): location id -&gt; (lat, lon)</span></span>
<span id="cb7-30"><a href="#cb7-30"></a><span class="co">            edges (list): list of edges</span></span>
<span id="cb7-31"><a href="#cb7-31"></a><span class="co">        """</span></span>
<span id="cb7-32"><a href="#cb7-32"></a>        G <span class="op">=</span> nx.DiGraph()</span>
<span id="cb7-33"><a href="#cb7-33"></a>        G.add_edges_from(edges)</span>
<span id="cb7-34"><a href="#cb7-34"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb7-35"><a href="#cb7-35"></a>        </span>
<span id="cb7-36"><a href="#cb7-36"></a>        colors <span class="op">=</span> mpl.colormaps[<span class="st">"Set1"</span>].colors</span>
<span id="cb7-37"><a href="#cb7-37"></a>        color_idx <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb7-38"><a href="#cb7-38"></a>        color <span class="op">=</span> np.array([colors[color_idx]])</span>
<span id="cb7-39"><a href="#cb7-39"></a>        </span>
<span id="cb7-40"><a href="#cb7-40"></a>        nx.draw_networkx_nodes(G, </span>
<span id="cb7-41"><a href="#cb7-41"></a>                                locations, </span>
<span id="cb7-42"><a href="#cb7-42"></a>                                nodelist<span class="op">=</span>[x[<span class="dv">0</span>] </span>
<span id="cb7-43"><a href="#cb7-43"></a>                                        <span class="cf">for</span> x <span class="kw">in</span> edges], </span>
<span id="cb7-44"><a href="#cb7-44"></a>                                node_color<span class="op">=</span>color)</span>
<span id="cb7-45"><a href="#cb7-45"></a>        nx.draw_networkx_edges(G,</span>
<span id="cb7-46"><a href="#cb7-46"></a>                                locations, </span>
<span id="cb7-47"><a href="#cb7-47"></a>                                edgelist<span class="op">=</span>edges,</span>
<span id="cb7-48"><a href="#cb7-48"></a>                                width<span class="op">=</span><span class="dv">4</span>, </span>
<span id="cb7-49"><a href="#cb7-49"></a>                                edge_color<span class="op">=</span>color, </span>
<span id="cb7-50"><a href="#cb7-50"></a>                                style<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb7-51"><a href="#cb7-51"></a>        </span>
<span id="cb7-52"><a href="#cb7-52"></a>        <span class="co"># labels</span></span>
<span id="cb7-53"><a href="#cb7-53"></a>        nx.draw_networkx_labels(G, locations, </span>
<span id="cb7-54"><a href="#cb7-54"></a>                                font_color<span class="op">=</span><span class="st">'w'</span>, </span>
<span id="cb7-55"><a href="#cb7-55"></a>                                font_size<span class="op">=</span><span class="dv">12</span>, </span>
<span id="cb7-56"><a href="#cb7-56"></a>                                font_family<span class="op">=</span><span class="st">'sans-serif'</span>)</span>
<span id="cb7-57"><a href="#cb7-57"></a></span>
<span id="cb7-58"><a href="#cb7-58"></a>        <span class="co">#print out the graph</span></span>
<span id="cb7-59"><a href="#cb7-59"></a>        plt.axis(<span class="st">'off'</span>)</span>
<span id="cb7-60"><a href="#cb7-60"></a>        plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s load the optimal solution for the aforementioned instance and show its content below.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>solution <span class="op">=</span> tsplib95.load(<span class="st">'./data/tsp/ulysses22.opt.tour'</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a>solution.as_name_dict()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>{'name': 'ulysses22.opt.tour',
 'comment': 'Optimal solution of ulysses22 (7013)',
 'type': 'TOUR',
 'dimension': 22,
 'tours': [[1,
   14,
   13,
   12,
   7,
   6,
   15,
   5,
   11,
   9,
   10,
   19,
   20,
   21,
   16,
   3,
   2,
   17,
   22,
   4,
   18,
   8]]}</code></pre>
</div>
</div>
<p>The code snippet below plots the optimal tour, which is shown in <a href="#fig-tsp-ulysses22-sol">Figure&nbsp;<span>6.1</span></a>.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>locations <span class="op">=</span> problem.node_coords</span>
<span id="cb10-2"><a href="#cb10-2"></a>tour <span class="op">=</span> solution.tours[<span class="dv">0</span>]</span>
<span id="cb10-3"><a href="#cb10-3"></a>edges <span class="op">=</span> []</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(tour) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb10-5"><a href="#cb10-5"></a>    edges.append((tour[i], tour[i <span class="op">+</span> <span class="dv">1</span>]))</span>
<span id="cb10-6"><a href="#cb10-6"></a>edges.append((tour[<span class="op">-</span><span class="dv">1</span>], tour[<span class="dv">0</span>]))</span>
<span id="cb10-7"><a href="#cb10-7"></a>edges <span class="op">=</span> []</span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(tour) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb10-9"><a href="#cb10-9"></a>    edges.append((tour[i], tour[i <span class="op">+</span> <span class="dv">1</span>]))</span>
<span id="cb10-10"><a href="#cb10-10"></a>edges.append((tour[<span class="op">-</span><span class="dv">1</span>], tour[<span class="dv">0</span>]))</span>
<span id="cb10-11"><a href="#cb10-11"></a>TspVisualizer.show(locations, edges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-tsp-ulysses22-sol" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="ip-tsp_files/figure-html/fig-tsp-ulysses22-sol-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.1: Optimal tour of the <em>ulysses22</em> instance</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Let’s put this visualization procedure into a dedicated function, as is given below.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="im">import</span> tsplib95</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="kw">def</span> visualize_tsp(instance_name: <span class="bu">str</span>):</span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="co"># load problem</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>    problem <span class="op">=</span> tsplib95.load(<span class="ss">f'./data/tsp/</span><span class="sc">{</span>instance_name<span class="sc">}</span><span class="ss">.tsp'</span>)</span>
<span id="cb11-6"><a href="#cb11-6"></a>    solution <span class="op">=</span> tsplib95.load(<span class="ss">f'./data/tsp/</span><span class="sc">{</span>instance_name<span class="sc">}</span><span class="ss">.opt.tour'</span>)</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a>    locations <span class="op">=</span> problem.node_coords</span>
<span id="cb11-9"><a href="#cb11-9"></a>    tour <span class="op">=</span> solution.tours[<span class="dv">0</span>]</span>
<span id="cb11-10"><a href="#cb11-10"></a>    edges <span class="op">=</span> []</span>
<span id="cb11-11"><a href="#cb11-11"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(tour) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb11-12"><a href="#cb11-12"></a>        edges.append((tour[i], tour[i <span class="op">+</span> <span class="dv">1</span>]))</span>
<span id="cb11-13"><a href="#cb11-13"></a>    edges.append((tour[<span class="op">-</span><span class="dv">1</span>], tour[<span class="dv">0</span>]))</span>
<span id="cb11-14"><a href="#cb11-14"></a>    edges <span class="op">=</span> []</span>
<span id="cb11-15"><a href="#cb11-15"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(tour) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb11-16"><a href="#cb11-16"></a>        edges.append((tour[i], tour[i <span class="op">+</span> <span class="dv">1</span>]))</span>
<span id="cb11-17"><a href="#cb11-17"></a>    edges.append((tour[<span class="op">-</span><span class="dv">1</span>], tour[<span class="dv">0</span>]))</span>
<span id="cb11-18"><a href="#cb11-18"></a>    TspVisualizer.show(locations, edges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#fig-tsp-berlin52-sol">Figure&nbsp;<span>6.2</span></a> and <a href="#fig-tsp-pr76-sol">Figure&nbsp;<span>6.3</span></a> show the optimal tours for the <em>berlin52</em> and <em>pr76</em> instances, respectively.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>visualize_tsp(<span class="st">'berlin52'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-tsp-berlin52-sol" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="ip-tsp_files/figure-html/fig-tsp-berlin52-sol-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.2: Optimal tour of the <em>berlin52</em> instance</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>visualize_tsp(<span class="st">'pr76'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-tsp-pr76-sol" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="ip-tsp_files/figure-html/fig-tsp-pr76-sol-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.3: Optimal tour of the <em>pr76</em> instance</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="problem-description" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="problem-description"><span class="header-section-number">6.2</span> Problem Description</h2>
<p>Let <span class="math inline">\(\mathcal{G} = (\mathcal{V}, \mathcal{A})\)</span> be an undirected complete graph, where <span class="math inline">\(V = \{1, 2, \cdots, n\}\)</span> represents a set of <span class="math inline">\(n\)</span> cities or vertices, and <span class="math inline">\(\mathcal{A} = \{(i, j)\ |\ i, j \in \mathcal{V}, i \neq j\}\)</span> represents the set of edges connecting these cities. The edges in <span class="math inline">\(\mathcal{A}\)</span> have weights or distances associated with them, <span class="math inline">\(c_{ij}\)</span>, representing the distances or costs to travel between pairs of cities.</p>
<p>The objective of the TSP is to find the shortest possible closed tour that visits each city in <span class="math inline">\(\mathcal{V}\)</span> exactly once and returns to the starting city, while obeying the following constraints:</p>
<ul>
<li>Each city must be visited exactly once: The tour must include all the cities in <span class="math inline">\(\mathcal{V}\)</span>, and each city must be visited exactly once during the tour.</li>
<li>The tour must be closed: The last city visited in the tour must be the same as the starting city, forming a closed loop.</li>
</ul>
</section>
<section id="model-1---dfj" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="model-1---dfj"><span class="header-section-number">6.3</span> Model 1 - DFJ</h2>
<p>The first formulation was proposed by <span class="citation" data-cites="dantzig_solution_1954">Dantzig, Fulkerson, and Johnson (<a href="references.html#ref-dantzig_solution_1954" role="doc-biblioref">1954</a>)</span>. It uses the following decision variables:</p>
<ul>
<li><span class="math inline">\(x_{ij}\)</span>: a binary variable that equals 1 if arc <span class="math inline">\((i, j) \in \mathcal{A}\)</span> shows up in the optimal solution, 0 otherwise</li>
</ul>
<p>We can state the model as follows:</p>
<p><span class="math display">\[\begin{align}
\text{min.} &amp;\quad \sum_{(i, j) \in \mathcal{A}} c_{ij} x_{ij} \label{tsp1-obj} \\
\text{s.t.} &amp;\quad \sum_{j \in \mathcal{V},\  j \neq i} x_{ij} = 1, \ \forall i \in \mathcal{V} \label{tsp1-cons1} \\
&amp;\quad \sum_{i \in \mathcal{V}, \ i \neq j} x_{ij} = 1, \ \forall j \in \mathcal{V} \label{tsp1-cons2}\\
&amp;\quad
\begin{split}
    &amp; \sum_{i, j \in S, \ (i, j) \in \mathcal{A}} x_{ij} \leq |S| - 1,\\
    &amp;\qquad \forall S \subset \mathcal{V}, \ 2 \leq |S| \leq n - 2
\end{split}
\label{tsp1-cons3}  \\
&amp;\quad x_{ij} \in \{0, 1\}, \ \forall (i, j) \in \mathcal{A} \label{tsp1-cons4}
\end{align}\]</span></p>
<p>This specific TSP formulation aims to find the optimal route with the shortest total distance. To ensure that each node is visited exactly once, constraints <span class="math inline">\(\eqref{tsp1-cons1}\)</span> and <span class="math inline">\(\eqref{tsp1-cons2}\)</span>, also known as <em>degree constraints</em>, are used. Another set of constraints <span class="math inline">\(\eqref{tsp1-cons3}\)</span>, called subtour elimination constraints, ensure that the solution does not contain any subtours. Subtours are smaller cycles within the larger route that violate the requirement of visiting each city exactly once. Two examples of solutions with subtours are shown in figures <a href="#fig-subtour1">Figure&nbsp;<span>6.4</span></a> and <a href="#fig-subtour2">Figure&nbsp;<span>6.5</span></a>. While these solutions satisfy the degree constraints, they violate the subtour elimination constraints. A subtour contains the same number of edges (or arcs) as nodes, so limiting the number of edges to be less than the number of nodes can help to eliminate subtours. Furthermore, because of the presence of degree constraints, subtours with only one node cannot exist, and similarly, subtours with <span class="math inline">\(n-1\)</span> nodes are also impossible. Therefore, it is acceptable to define the subtour elimination constraints only for subtours that contain between 2 and <span class="math inline">\(n-2\)</span> nodes.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-subtour1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div>
<pre class="mermaid mermaid-js" data-label="fig-subtour1">flowchart LR
    1((1)) --&gt; 2((2))
    2 --&gt; 3((3))
    3 --&gt; 4((4))
    4 --&gt; 7((7))
    7 --&gt; 1
    5((5)) --&gt; 6((6))
    6 --&gt; 5
</pre>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.4: Subtour with 2 nodes</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-subtour2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div>
<pre class="mermaid mermaid-js" data-label="fig-subtour2">flowchart LR
    1((1)) --&gt; 2((2))
    2 --&gt; 3((3))
    3 --&gt; 7((7))
    7 --&gt; 1
    4((4)) --&gt; 5((5)) 
    5 --&gt; 6((6))
    6 --&gt; 4
</pre>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.5: Subtour with 3 nodes</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>An equivalent way of constraints <span class="math inline">\(\eqref{tsp1-cons3}\)</span> is</p>
<p><span class="math display">\[\begin{align}
    \sum_{i \in S}\sum_{j \notin S} x_{ij} \geq 1, \ \forall S \subset \mathcal{V}, \ 2 \leq |S| \leq n - 2 \label{tsp1-cons5}
\end{align}\]</span></p>
<p>To understand this, observe that the value of <span class="math inline">\(|S|\)</span> can be calculated as the sum of two terms: the sum of the decision variables <span class="math inline">\(x_{ij}\)</span> for all edges <span class="math inline">\((i,j)\)</span> that are included in the subset, and the sum of the decision variables <span class="math inline">\(x_{ij}\)</span> for all edges that cross the boundary of the subtour, that is, <span class="math inline">\(|S| = \sum_{i, j \in S, \ (i, j) \in \mathcal{A}} x_{ij} + \sum_{i \in S}\sum_{j \notin S} x_{ij}\)</span>. This means that the constraints <span class="math inline">\(\eqref{tsp1-cons3}\)</span> and <span class="math inline">\(\eqref{tsp1-cons5}\)</span> are interchangeable, as they represent the same condition in different forms.</p>
<p>To simplify the implementation of different TSP formulations that will be presented in the following sections, we have created a base class called <code>TspModel</code> in the code below. This class contains the instance information that needs to be solved, as well as several helper functions. Within the class definition, the attribute <code>_node_list</code> holds the list of nodes that must be visited by the TSP tour. The attribute <code>_node_coords</code> is a dictionary that stores the location information for each node. Finally, the attribute <code>_distance</code> is another dictionary that provides the distance between any pair of nodes. The <code>read_inputs()</code> function, defined between lines 15 and 31, takes a TSP problem instance and extracts the necessary information for solving the problem later. The <code>get_combinations()</code> function, defined between lines 33 and 34, generates all possible combinations of nodes with the specified size.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="im">from</span> itertools <span class="im">import</span> combinations</span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="im">import</span> tsplib95</span>
<span id="cb14-4"><a href="#cb14-4"></a></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="kw">class</span> TspModel:</span>
<span id="cb14-6"><a href="#cb14-6"></a>    <span class="co">"""base class for TSP models</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co">    """</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>    </span>
<span id="cb14-9"><a href="#cb14-9"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name: <span class="bu">str</span>):</span>
<span id="cb14-10"><a href="#cb14-10"></a>        <span class="va">self</span>._name: <span class="bu">str</span> <span class="op">=</span> name</span>
<span id="cb14-11"><a href="#cb14-11"></a>        <span class="va">self</span>._node_list: List[<span class="bu">int</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>        <span class="va">self</span>._node_coords: Dict[<span class="bu">int</span>, List[<span class="bu">float</span>, <span class="bu">float</span>]] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>        <span class="va">self</span>._distance: Dict[<span class="bu">int</span>, Dict[<span class="bu">int</span>, <span class="bu">int</span>]] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>        </span>
<span id="cb14-15"><a href="#cb14-15"></a>    <span class="kw">def</span> read_inputs(<span class="va">self</span>, instance_file: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb14-16"><a href="#cb14-16"></a>        problem <span class="op">=</span> tsplib95.load(instance_file)</span>
<span id="cb14-17"><a href="#cb14-17"></a></span>
<span id="cb14-18"><a href="#cb14-18"></a>        node_coords <span class="op">=</span> problem.node_coords</span>
<span id="cb14-19"><a href="#cb14-19"></a>        <span class="va">self</span>._node_coords <span class="op">=</span> {</span>
<span id="cb14-20"><a href="#cb14-20"></a>            <span class="bu">id</span>: node_coords[<span class="bu">id</span>]</span>
<span id="cb14-21"><a href="#cb14-21"></a>            <span class="cf">for</span> <span class="bu">id</span> <span class="kw">in</span> node_coords</span>
<span id="cb14-22"><a href="#cb14-22"></a>        }</span>
<span id="cb14-23"><a href="#cb14-23"></a>        <span class="va">self</span>._node_list <span class="op">=</span> <span class="bu">list</span>(node_coords.keys())</span>
<span id="cb14-24"><a href="#cb14-24"></a>        </span>
<span id="cb14-25"><a href="#cb14-25"></a>        <span class="va">self</span>._distance <span class="op">=</span> {}</span>
<span id="cb14-26"><a href="#cb14-26"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="va">self</span>._node_list:</span>
<span id="cb14-27"><a href="#cb14-27"></a>            dist <span class="op">=</span> {</span>
<span id="cb14-28"><a href="#cb14-28"></a>                j: problem.get_weight(i, j)</span>
<span id="cb14-29"><a href="#cb14-29"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="va">self</span>._node_list</span>
<span id="cb14-30"><a href="#cb14-30"></a>            }</span>
<span id="cb14-31"><a href="#cb14-31"></a>            <span class="va">self</span>._distance[i] <span class="op">=</span> dist</span>
<span id="cb14-32"><a href="#cb14-32"></a></span>
<span id="cb14-33"><a href="#cb14-33"></a>    <span class="kw">def</span> get_combinations(<span class="va">self</span>, size):</span>
<span id="cb14-34"><a href="#cb14-34"></a>        <span class="cf">return</span> <span class="bu">list</span>(combinations(<span class="va">self</span>._node_list, size))</span>
<span id="cb14-35"><a href="#cb14-35"></a>        </span>
<span id="cb14-36"><a href="#cb14-36"></a>    <span class="at">@property</span></span>
<span id="cb14-37"><a href="#cb14-37"></a>    <span class="kw">def</span> name(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._name</span>
<span id="cb14-38"><a href="#cb14-38"></a>    </span>
<span id="cb14-39"><a href="#cb14-39"></a>    <span class="at">@property</span></span>
<span id="cb14-40"><a href="#cb14-40"></a>    <span class="kw">def</span> num_nodes(<span class="va">self</span>): <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._node_coords)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To implement the TSP model using OR-Tools, we define the <code>TspModelV1</code> class that inherits from the base class <code>TspModel</code>. The constructor initializes a solver object and defines attributes to store decision variables and the optimal solution. The <code>_create_variables()</code> function creates binary decision variables for every arc in the problem, while the <code>_create_objective()</code> function calculates the total traveling cost. Degree constraints are defined in the <code>_create_degree_constraints()</code> function, while the subtour elimination constraints are defined in the <code>_create_subtour_elimination_constraints()</code> function. The <code>build_model()</code> function needs to be called before optimize() to construct the model.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="im">from</span> ortools.linear_solver <span class="im">import</span> pywraplp</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="kw">class</span> TspModelV1(TspModel):</span>
<span id="cb15-5"><a href="#cb15-5"></a>    </span>
<span id="cb15-6"><a href="#cb15-6"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name<span class="op">=</span><span class="st">'Tspmodel_v1'</span>):</span>
<span id="cb15-7"><a href="#cb15-7"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(name)</span>
<span id="cb15-8"><a href="#cb15-8"></a>        </span>
<span id="cb15-9"><a href="#cb15-9"></a>        <span class="va">self</span>._solver <span class="op">=</span> pywraplp.Solver.CreateSolver(<span class="st">'SCIP'</span>)</span>
<span id="cb15-10"><a href="#cb15-10"></a>        <span class="va">self</span>._var_x <span class="op">=</span> <span class="va">None</span></span>
<span id="cb15-11"><a href="#cb15-11"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="cb15-12"><a href="#cb15-12"></a>        <span class="va">self</span>._opt_x <span class="op">=</span> <span class="va">None</span></span>
<span id="cb15-13"><a href="#cb15-13"></a>        <span class="va">self</span>._opt_route <span class="op">=</span> <span class="va">None</span></span>
<span id="cb15-14"><a href="#cb15-14"></a>    </span>
<span id="cb15-15"><a href="#cb15-15"></a>    <span class="kw">def</span> build_model(<span class="va">self</span>):</span>
<span id="cb15-16"><a href="#cb15-16"></a>        <span class="va">self</span>._create_variables()</span>
<span id="cb15-17"><a href="#cb15-17"></a>        <span class="va">self</span>._create_objective()</span>
<span id="cb15-18"><a href="#cb15-18"></a>        <span class="va">self</span>._create_degree_constraints()</span>
<span id="cb15-19"><a href="#cb15-19"></a>        <span class="va">self</span>._create_subtour_elimination_constraints()</span>
<span id="cb15-20"><a href="#cb15-20"></a>    </span>
<span id="cb15-21"><a href="#cb15-21"></a>    <span class="kw">def</span> optimize(<span class="va">self</span>, enable_output: <span class="bu">bool</span>):</span>
<span id="cb15-22"><a href="#cb15-22"></a>        <span class="cf">if</span> enable_output: <span class="va">self</span>._solver.EnableOutput()</span>
<span id="cb15-23"><a href="#cb15-23"></a>        status <span class="op">=</span> <span class="va">self</span>._solver.Solve()</span>
<span id="cb15-24"><a href="#cb15-24"></a>        <span class="cf">if</span> status <span class="kw">is</span> pywraplp.Solver.OPTIMAL:</span>
<span id="cb15-25"><a href="#cb15-25"></a>            <span class="va">self</span>._retrieve_opt_solution()</span>
<span id="cb15-26"><a href="#cb15-26"></a>            <span class="va">self</span>._retrieve_opt_route()</span>
<span id="cb15-27"><a href="#cb15-27"></a>    </span>
<span id="cb15-28"><a href="#cb15-28"></a>    <span class="kw">def</span> _create_variables(<span class="va">self</span>):</span>
<span id="cb15-29"><a href="#cb15-29"></a>        <span class="va">self</span>._var_x <span class="op">=</span> {}</span>
<span id="cb15-30"><a href="#cb15-30"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="va">self</span>._node_list:</span>
<span id="cb15-31"><a href="#cb15-31"></a>            <span class="va">self</span>._var_x[i] <span class="op">=</span> {</span>
<span id="cb15-32"><a href="#cb15-32"></a>                j: <span class="va">self</span>._solver.BoolVar(<span class="st">'x_{i, j}'</span>)</span>
<span id="cb15-33"><a href="#cb15-33"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="va">self</span>._node_list</span>
<span id="cb15-34"><a href="#cb15-34"></a>                <span class="cf">if</span> j <span class="op">!=</span> i</span>
<span id="cb15-35"><a href="#cb15-35"></a>            }</span>
<span id="cb15-36"><a href="#cb15-36"></a>    </span>
<span id="cb15-37"><a href="#cb15-37"></a>    <span class="kw">def</span> _create_objective(<span class="va">self</span>):</span>
<span id="cb15-38"><a href="#cb15-38"></a>        node_list <span class="op">=</span> <span class="va">self</span>._node_list</span>
<span id="cb15-39"><a href="#cb15-39"></a>        expr <span class="op">=</span> [<span class="va">self</span>._distance[i][j] <span class="op">*</span> <span class="va">self</span>._var_x[i][j]</span>
<span id="cb15-40"><a href="#cb15-40"></a>                <span class="cf">for</span> i, j <span class="kw">in</span> product(node_list, node_list)</span>
<span id="cb15-41"><a href="#cb15-41"></a>                <span class="cf">if</span> i <span class="op">!=</span> j]</span>
<span id="cb15-42"><a href="#cb15-42"></a>        <span class="va">self</span>._solver.Minimize(<span class="va">self</span>._solver.Sum(expr))</span>
<span id="cb15-43"><a href="#cb15-43"></a>        </span>
<span id="cb15-44"><a href="#cb15-44"></a>    <span class="kw">def</span> _create_degree_constraints(<span class="va">self</span>):</span>
<span id="cb15-45"><a href="#cb15-45"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="va">self</span>._node_list:</span>
<span id="cb15-46"><a href="#cb15-46"></a>            out_expr <span class="op">=</span> [<span class="va">self</span>._var_x[i][j]</span>
<span id="cb15-47"><a href="#cb15-47"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="va">self</span>._node_list</span>
<span id="cb15-48"><a href="#cb15-48"></a>                    <span class="cf">if</span> j <span class="op">!=</span> i</span>
<span id="cb15-49"><a href="#cb15-49"></a>                    ]</span>
<span id="cb15-50"><a href="#cb15-50"></a>            in_expr <span class="op">=</span> [<span class="va">self</span>._var_x[j][i]</span>
<span id="cb15-51"><a href="#cb15-51"></a>                        <span class="cf">for</span> j <span class="kw">in</span> <span class="va">self</span>._node_list</span>
<span id="cb15-52"><a href="#cb15-52"></a>                        <span class="cf">if</span> j <span class="op">!=</span> i</span>
<span id="cb15-53"><a href="#cb15-53"></a>                    ]</span>
<span id="cb15-54"><a href="#cb15-54"></a>            <span class="va">self</span>._solver.Add(<span class="va">self</span>._solver.Sum(out_expr) <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb15-55"><a href="#cb15-55"></a>            <span class="va">self</span>._solver.Add(<span class="va">self</span>._solver.Sum(in_expr) <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb15-56"><a href="#cb15-56"></a>    </span>
<span id="cb15-57"><a href="#cb15-57"></a>    <span class="kw">def</span> _create_subtour_elimination_constraints(<span class="va">self</span>):</span>
<span id="cb15-58"><a href="#cb15-58"></a>        num_nodes <span class="op">=</span> <span class="va">self</span>.num_nodes</span>
<span id="cb15-59"><a href="#cb15-59"></a>        <span class="cf">for</span> size <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, num_nodes <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb15-60"><a href="#cb15-60"></a>            combinations <span class="op">=</span> <span class="va">self</span>.get_combinations(size)</span>
<span id="cb15-61"><a href="#cb15-61"></a>            <span class="cf">for</span> comb <span class="kw">in</span> combinations:</span>
<span id="cb15-62"><a href="#cb15-62"></a>                expr <span class="op">=</span> [<span class="va">self</span>._var_x[i][j]</span>
<span id="cb15-63"><a href="#cb15-63"></a>                        <span class="cf">for</span> i, j <span class="kw">in</span> product(comb, comb)</span>
<span id="cb15-64"><a href="#cb15-64"></a>                        <span class="cf">if</span> i <span class="op">!=</span> j]</span>
<span id="cb15-65"><a href="#cb15-65"></a>                <span class="va">self</span>._solver.Add(<span class="va">self</span>._solver.Sum(expr) <span class="op">&lt;=</span> </span>
<span id="cb15-66"><a href="#cb15-66"></a>                                <span class="bu">len</span>(comb) <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb15-67"><a href="#cb15-67"></a>    </span>
<span id="cb15-68"><a href="#cb15-68"></a>    <span class="kw">def</span> _retrieve_opt_solution(<span class="va">self</span>):</span>
<span id="cb15-69"><a href="#cb15-69"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="bu">float</span>(<span class="va">self</span>._solver.Objective().Value())</span>
<span id="cb15-70"><a href="#cb15-70"></a>        <span class="va">self</span>._opt_x <span class="op">=</span> {}</span>
<span id="cb15-71"><a href="#cb15-71"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="va">self</span>._node_list:</span>
<span id="cb15-72"><a href="#cb15-72"></a>            <span class="va">self</span>._opt_x[i] <span class="op">=</span> {</span>
<span id="cb15-73"><a href="#cb15-73"></a>                j: <span class="bu">round</span>(<span class="va">self</span>._var_x[i][j].solution_value())</span>
<span id="cb15-74"><a href="#cb15-74"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="va">self</span>._node_list</span>
<span id="cb15-75"><a href="#cb15-75"></a>                <span class="cf">if</span> j <span class="op">!=</span> i</span>
<span id="cb15-76"><a href="#cb15-76"></a>            }</span>
<span id="cb15-77"><a href="#cb15-77"></a>            </span>
<span id="cb15-78"><a href="#cb15-78"></a>        <span class="bu">print</span>(<span class="ss">f'optimal value = </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb15-79"><a href="#cb15-79"></a>    </span>
<span id="cb15-80"><a href="#cb15-80"></a>    <span class="kw">def</span> _retrieve_opt_route(<span class="va">self</span>):</span>
<span id="cb15-81"><a href="#cb15-81"></a>        <span class="va">self</span>._opt_route <span class="op">=</span> []</span>
<span id="cb15-82"><a href="#cb15-82"></a>        route_start <span class="op">=</span> <span class="bu">list</span>(<span class="va">self</span>._opt_x.keys())[<span class="dv">0</span>]</span>
<span id="cb15-83"><a href="#cb15-83"></a>        edge_start <span class="op">=</span> route_start</span>
<span id="cb15-84"><a href="#cb15-84"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb15-85"><a href="#cb15-85"></a>            <span class="cf">for</span> n <span class="kw">in</span> <span class="va">self</span>._opt_x[edge_start]:</span>
<span id="cb15-86"><a href="#cb15-86"></a>                <span class="cf">if</span> <span class="va">self</span>._opt_x[edge_start][n] <span class="op">==</span> <span class="dv">0</span>: <span class="cf">continue</span></span>
<span id="cb15-87"><a href="#cb15-87"></a>                </span>
<span id="cb15-88"><a href="#cb15-88"></a>                edge_end <span class="op">=</span> n</span>
<span id="cb15-89"><a href="#cb15-89"></a>                <span class="va">self</span>._opt_route.append((edge_start, edge_end))</span>
<span id="cb15-90"><a href="#cb15-90"></a>                <span class="cf">break</span></span>
<span id="cb15-91"><a href="#cb15-91"></a>            </span>
<span id="cb15-92"><a href="#cb15-92"></a>            <span class="cf">if</span> edge_end <span class="op">==</span> route_start: <span class="cf">break</span></span>
<span id="cb15-93"><a href="#cb15-93"></a>            edge_start <span class="op">=</span> edge_end</span>
<span id="cb15-94"><a href="#cb15-94"></a>            </span>
<span id="cb15-95"><a href="#cb15-95"></a>    <span class="kw">def</span> show_opt_route(<span class="va">self</span>):</span>
<span id="cb15-96"><a href="#cb15-96"></a>        TspVisualizer.show(<span class="va">self</span>._node_coords, <span class="va">self</span>._opt_route)</span>
<span id="cb15-97"><a href="#cb15-97"></a>        </span>
<span id="cb15-98"><a href="#cb15-98"></a>        </span>
<span id="cb15-99"><a href="#cb15-99"></a>    <span class="kw">def</span> show_model_info(<span class="va">self</span>):</span>
<span id="cb15-100"><a href="#cb15-100"></a>        <span class="bu">print</span>(<span class="ss">f"Number of variables: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_solver<span class="sc">.</span>NumVariables()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-101"><a href="#cb15-101"></a>        <span class="bu">print</span>(<span class="ss">f"Number of constraints: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_solver<span class="sc">.</span>NumConstraints()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we use the <code>TspModelV1</code> class to solve the <em>burma14</em> instance and plots the optimal solution found by the OR-Tools in <a href="#fig-tsp-model1-burma14-sol">Figure&nbsp;<span>6.6</span></a>.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>instance <span class="op">=</span> <span class="st">'./data/tsp/burma14.tsp'</span></span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a>model_v1 <span class="op">=</span> TspModelV1()</span>
<span id="cb16-4"><a href="#cb16-4"></a>model_v1.read_inputs(instance_file<span class="op">=</span>instance)</span>
<span id="cb16-5"><a href="#cb16-5"></a>model_v1.build_model()</span>
<span id="cb16-6"><a href="#cb16-6"></a>model_v1.show_model_info()</span>
<span id="cb16-7"><a href="#cb16-7"></a>model_v1.optimize(<span class="va">False</span>)</span>
<span id="cb16-8"><a href="#cb16-8"></a>model_v1.show_opt_route()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of variables: 182
Number of constraints: 16382
optimal value = 3323.0</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-tsp-model1-burma14-sol" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="ip-tsp_files/figure-html/fig-tsp-model1-burma14-sol-output-2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.6: Optimal route for the <em>burma14</em> instance</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-2---mtz" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="model-2---mtz"><span class="header-section-number">6.4</span> Model 2 - MTZ</h2>
<p>In this formulation, an alternative way of modeling the subtour elimination constraints was proposed by <span class="citation" data-cites="miller_integer_1960">Miller, Tucker, and Zemlin (<a href="references.html#ref-miller_integer_1960" role="doc-biblioref">1960</a>)</span>. The model uses two types of decision variables:</p>
<ul>
<li><span class="math inline">\(x_{ij}\)</span>: a binary variable that equals 1 if arc <span class="math inline">\((i, j) \in \mathcal{A}\)</span> shows up in the optimal solution, 0 otherwise</li>
<li><span class="math inline">\(u_i\)</span>: a continuous variable for <span class="math inline">\(i \in \mathcal{V} \backslash \{1\}\)</span></li>
</ul>
<p>The complete formulation is given below.</p>
<p><span class="math display">\[\begin{align}
\text{min.} &amp;\quad \sum_{(i, j) \in \mathcal{A}} c_{ij} x_{ij} \label{tsp2-obj} \\
\text{s.t.} &amp;\quad \sum_{j \in \mathcal{V},\  j \neq i} x_{ij} = 1, \ \forall i \in \mathcal{V} \label{tsp2-cons1} \\
&amp;\quad \sum_{i \in \mathcal{V}, \ i \neq j} x_{ij} = 1, \ \forall j \in \mathcal{V} \label{tsp2-cons2}\\
&amp;\quad
\begin{split}
    &amp;u_i - u_j + (n - 1) x_{ij} \leq n - 2, \\
    &amp;\qquad \forall i, j \in \{2, \cdots, n\}, i \neq j
\end{split}
\label{tsp2-cons4} \\
&amp;\quad 1 \leq n_i \leq n - 1, i = 2, \cdots, n \label{tsp2-cons5}
\end{align}\]</span></p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="im">from</span> ortools.linear_solver <span class="im">import</span> pywraplp</span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="kw">class</span> TspModelV2(TspModel):</span>
<span id="cb18-5"><a href="#cb18-5"></a>    </span>
<span id="cb18-6"><a href="#cb18-6"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name<span class="op">=</span><span class="st">'Tspmodel_v2'</span>):</span>
<span id="cb18-7"><a href="#cb18-7"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(name)</span>
<span id="cb18-8"><a href="#cb18-8"></a>        </span>
<span id="cb18-9"><a href="#cb18-9"></a>        <span class="va">self</span>._solver <span class="op">=</span> pywraplp.Solver.CreateSolver(<span class="st">'SCIP'</span>)</span>
<span id="cb18-10"><a href="#cb18-10"></a>        <span class="va">self</span>._var_x <span class="op">=</span> <span class="va">None</span></span>
<span id="cb18-11"><a href="#cb18-11"></a>        <span class="va">self</span>._var_u <span class="op">=</span> <span class="va">None</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="va">None</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>        <span class="va">self</span>._opt_x <span class="op">=</span> <span class="va">None</span></span>
<span id="cb18-14"><a href="#cb18-14"></a>        <span class="va">self</span>._opt_route <span class="op">=</span> <span class="va">None</span></span>
<span id="cb18-15"><a href="#cb18-15"></a>    </span>
<span id="cb18-16"><a href="#cb18-16"></a>    <span class="kw">def</span> build_model(<span class="va">self</span>):</span>
<span id="cb18-17"><a href="#cb18-17"></a>        <span class="va">self</span>._create_variables()</span>
<span id="cb18-18"><a href="#cb18-18"></a>        <span class="va">self</span>._create_objective()</span>
<span id="cb18-19"><a href="#cb18-19"></a>        <span class="va">self</span>._create_degree_constraints()</span>
<span id="cb18-20"><a href="#cb18-20"></a>        <span class="va">self</span>._create_subtour_elimination_constraints()</span>
<span id="cb18-21"><a href="#cb18-21"></a>    </span>
<span id="cb18-22"><a href="#cb18-22"></a>    <span class="kw">def</span> optimize(<span class="va">self</span>, enable_output: <span class="bu">bool</span>):</span>
<span id="cb18-23"><a href="#cb18-23"></a>        <span class="cf">if</span> enable_output: <span class="va">self</span>._solver.EnableOutput()</span>
<span id="cb18-24"><a href="#cb18-24"></a>        status <span class="op">=</span> <span class="va">self</span>._solver.Solve()</span>
<span id="cb18-25"><a href="#cb18-25"></a>        <span class="cf">if</span> status <span class="kw">is</span> pywraplp.Solver.OPTIMAL:</span>
<span id="cb18-26"><a href="#cb18-26"></a>            <span class="va">self</span>._retrieve_opt_solution()</span>
<span id="cb18-27"><a href="#cb18-27"></a>            <span class="va">self</span>._retrieve_opt_route()</span>
<span id="cb18-28"><a href="#cb18-28"></a>    </span>
<span id="cb18-29"><a href="#cb18-29"></a>    <span class="kw">def</span> _create_variables(<span class="va">self</span>):</span>
<span id="cb18-30"><a href="#cb18-30"></a>        <span class="va">self</span>._var_x <span class="op">=</span> {}</span>
<span id="cb18-31"><a href="#cb18-31"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="va">self</span>._node_list:</span>
<span id="cb18-32"><a href="#cb18-32"></a>            <span class="va">self</span>._var_x[i] <span class="op">=</span> {</span>
<span id="cb18-33"><a href="#cb18-33"></a>                j: <span class="va">self</span>._solver.BoolVar(<span class="st">'x_{i, j}'</span>)</span>
<span id="cb18-34"><a href="#cb18-34"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="va">self</span>._node_list</span>
<span id="cb18-35"><a href="#cb18-35"></a>                <span class="cf">if</span> j <span class="op">!=</span> i</span>
<span id="cb18-36"><a href="#cb18-36"></a>            }</span>
<span id="cb18-37"><a href="#cb18-37"></a>        </span>
<span id="cb18-38"><a href="#cb18-38"></a>        <span class="va">self</span>._var_u <span class="op">=</span> {</span>
<span id="cb18-39"><a href="#cb18-39"></a>            i: <span class="va">self</span>._solver.NumVar(<span class="dv">1</span>, <span class="va">self</span>.num_nodes, <span class="st">'v_</span><span class="sc">{i}</span><span class="st">'</span>)</span>
<span id="cb18-40"><a href="#cb18-40"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="va">self</span>._node_list</span>
<span id="cb18-41"><a href="#cb18-41"></a>            <span class="cf">if</span> i <span class="op">!=</span> <span class="dv">1</span></span>
<span id="cb18-42"><a href="#cb18-42"></a>        }</span>
<span id="cb18-43"><a href="#cb18-43"></a>    </span>
<span id="cb18-44"><a href="#cb18-44"></a>    <span class="kw">def</span> _create_objective(<span class="va">self</span>):</span>
<span id="cb18-45"><a href="#cb18-45"></a>        node_list <span class="op">=</span> <span class="va">self</span>._node_list</span>
<span id="cb18-46"><a href="#cb18-46"></a>        expr <span class="op">=</span> [<span class="va">self</span>._distance[i][j] <span class="op">*</span> <span class="va">self</span>._var_x[i][j]</span>
<span id="cb18-47"><a href="#cb18-47"></a>                <span class="cf">for</span> i, j <span class="kw">in</span> product(node_list, node_list)</span>
<span id="cb18-48"><a href="#cb18-48"></a>                <span class="cf">if</span> i <span class="op">!=</span> j]</span>
<span id="cb18-49"><a href="#cb18-49"></a>        <span class="va">self</span>._solver.Minimize(<span class="va">self</span>._solver.Sum(expr))</span>
<span id="cb18-50"><a href="#cb18-50"></a>        </span>
<span id="cb18-51"><a href="#cb18-51"></a>    <span class="kw">def</span> _create_degree_constraints(<span class="va">self</span>):</span>
<span id="cb18-52"><a href="#cb18-52"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="va">self</span>._node_list:</span>
<span id="cb18-53"><a href="#cb18-53"></a>            out_expr <span class="op">=</span> [<span class="va">self</span>._var_x[i][j]</span>
<span id="cb18-54"><a href="#cb18-54"></a>                    <span class="cf">for</span> j <span class="kw">in</span> <span class="va">self</span>._node_list</span>
<span id="cb18-55"><a href="#cb18-55"></a>                    <span class="cf">if</span> j <span class="op">!=</span> i</span>
<span id="cb18-56"><a href="#cb18-56"></a>                    ]</span>
<span id="cb18-57"><a href="#cb18-57"></a>            in_expr <span class="op">=</span> [<span class="va">self</span>._var_x[j][i]</span>
<span id="cb18-58"><a href="#cb18-58"></a>                        <span class="cf">for</span> j <span class="kw">in</span> <span class="va">self</span>._node_list</span>
<span id="cb18-59"><a href="#cb18-59"></a>                        <span class="cf">if</span> j <span class="op">!=</span> i</span>
<span id="cb18-60"><a href="#cb18-60"></a>                    ]</span>
<span id="cb18-61"><a href="#cb18-61"></a>            <span class="va">self</span>._solver.Add(<span class="va">self</span>._solver.Sum(out_expr) <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb18-62"><a href="#cb18-62"></a>            <span class="va">self</span>._solver.Add(<span class="va">self</span>._solver.Sum(in_expr) <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb18-63"><a href="#cb18-63"></a>    </span>
<span id="cb18-64"><a href="#cb18-64"></a>    <span class="kw">def</span> _create_subtour_elimination_constraints(<span class="va">self</span>):</span>
<span id="cb18-65"><a href="#cb18-65"></a>        num_nodes <span class="op">=</span> <span class="va">self</span>.num_nodes</span>
<span id="cb18-66"><a href="#cb18-66"></a>        <span class="cf">for</span> i, j <span class="kw">in</span> product(<span class="va">self</span>._node_list, <span class="va">self</span>._node_list):</span>
<span id="cb18-67"><a href="#cb18-67"></a>            <span class="cf">if</span> i <span class="op">==</span> j: <span class="cf">continue</span></span>
<span id="cb18-68"><a href="#cb18-68"></a>            <span class="cf">if</span> i <span class="op">==</span> <span class="dv">1</span> <span class="kw">or</span> j <span class="op">==</span> <span class="dv">1</span>: <span class="cf">continue</span></span>
<span id="cb18-69"><a href="#cb18-69"></a>            <span class="va">self</span>._solver.Add(<span class="va">self</span>._var_u[i] <span class="op">-</span> </span>
<span id="cb18-70"><a href="#cb18-70"></a>                            <span class="va">self</span>._var_u[j] <span class="op">+</span></span>
<span id="cb18-71"><a href="#cb18-71"></a>                            (num_nodes <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="va">self</span>._var_x[i][j] <span class="op">&lt;=</span></span>
<span id="cb18-72"><a href="#cb18-72"></a>                            num_nodes <span class="op">-</span> <span class="dv">2</span>)</span>
<span id="cb18-73"><a href="#cb18-73"></a>    </span>
<span id="cb18-74"><a href="#cb18-74"></a>    <span class="kw">def</span> _retrieve_opt_solution(<span class="va">self</span>):</span>
<span id="cb18-75"><a href="#cb18-75"></a>        <span class="va">self</span>._opt_obj <span class="op">=</span> <span class="bu">float</span>(<span class="va">self</span>._solver.Objective().Value())</span>
<span id="cb18-76"><a href="#cb18-76"></a>        <span class="va">self</span>._opt_x <span class="op">=</span> {}</span>
<span id="cb18-77"><a href="#cb18-77"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="va">self</span>._node_list:</span>
<span id="cb18-78"><a href="#cb18-78"></a>            <span class="va">self</span>._opt_x[i] <span class="op">=</span> {</span>
<span id="cb18-79"><a href="#cb18-79"></a>                j: <span class="bu">round</span>(<span class="va">self</span>._var_x[i][j].solution_value())</span>
<span id="cb18-80"><a href="#cb18-80"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="va">self</span>._node_list</span>
<span id="cb18-81"><a href="#cb18-81"></a>                <span class="cf">if</span> j <span class="op">!=</span> i</span>
<span id="cb18-82"><a href="#cb18-82"></a>            }</span>
<span id="cb18-83"><a href="#cb18-83"></a>            </span>
<span id="cb18-84"><a href="#cb18-84"></a>        <span class="bu">print</span>(<span class="ss">f'optimal value = </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_opt_obj<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb18-85"><a href="#cb18-85"></a>    </span>
<span id="cb18-86"><a href="#cb18-86"></a>    <span class="kw">def</span> _retrieve_opt_route(<span class="va">self</span>):</span>
<span id="cb18-87"><a href="#cb18-87"></a>        <span class="va">self</span>._opt_route <span class="op">=</span> []</span>
<span id="cb18-88"><a href="#cb18-88"></a>        route_start <span class="op">=</span> <span class="bu">list</span>(<span class="va">self</span>._opt_x.keys())[<span class="dv">0</span>]</span>
<span id="cb18-89"><a href="#cb18-89"></a>        edge_start <span class="op">=</span> route_start</span>
<span id="cb18-90"><a href="#cb18-90"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb18-91"><a href="#cb18-91"></a>            <span class="cf">for</span> n <span class="kw">in</span> <span class="va">self</span>._opt_x[edge_start]:</span>
<span id="cb18-92"><a href="#cb18-92"></a>                <span class="cf">if</span> <span class="va">self</span>._opt_x[edge_start][n] <span class="op">==</span> <span class="dv">0</span>: <span class="cf">continue</span></span>
<span id="cb18-93"><a href="#cb18-93"></a>                </span>
<span id="cb18-94"><a href="#cb18-94"></a>                edge_end <span class="op">=</span> n</span>
<span id="cb18-95"><a href="#cb18-95"></a>                <span class="va">self</span>._opt_route.append((edge_start, edge_end))</span>
<span id="cb18-96"><a href="#cb18-96"></a>                <span class="cf">break</span></span>
<span id="cb18-97"><a href="#cb18-97"></a>            </span>
<span id="cb18-98"><a href="#cb18-98"></a>            <span class="cf">if</span> edge_end <span class="op">==</span> route_start: <span class="cf">break</span></span>
<span id="cb18-99"><a href="#cb18-99"></a>            edge_start <span class="op">=</span> edge_end</span>
<span id="cb18-100"><a href="#cb18-100"></a>            </span>
<span id="cb18-101"><a href="#cb18-101"></a>    <span class="kw">def</span> show_opt_route(<span class="va">self</span>):</span>
<span id="cb18-102"><a href="#cb18-102"></a>        TspVisualizer.show(<span class="va">self</span>._node_coords, <span class="va">self</span>._opt_route)</span>
<span id="cb18-103"><a href="#cb18-103"></a>        </span>
<span id="cb18-104"><a href="#cb18-104"></a>        </span>
<span id="cb18-105"><a href="#cb18-105"></a>    <span class="kw">def</span> show_model_info(<span class="va">self</span>):</span>
<span id="cb18-106"><a href="#cb18-106"></a>        <span class="bu">print</span>(<span class="ss">f"Number of variables: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_solver<span class="sc">.</span>NumVariables()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-107"><a href="#cb18-107"></a>        <span class="bu">print</span>(<span class="ss">f"Number of constraints: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_solver<span class="sc">.</span>NumConstraints()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>instance <span class="op">=</span> <span class="st">'./data/tsp/burma14.tsp'</span></span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>model_v2 <span class="op">=</span> TspModelV2()</span>
<span id="cb19-4"><a href="#cb19-4"></a>model_v2.read_inputs(instance_file<span class="op">=</span>instance)</span>
<span id="cb19-5"><a href="#cb19-5"></a>model_v2.build_model()</span>
<span id="cb19-6"><a href="#cb19-6"></a>model_v2.show_model_info()</span>
<span id="cb19-7"><a href="#cb19-7"></a>model_v2.optimize(<span class="va">False</span>)</span>
<span id="cb19-8"><a href="#cb19-8"></a>model_v2.show_opt_route()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of variables: 195
Number of constraints: 184
optimal value = 3323.00</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-tsp-model2-burma14-sol" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="ip-tsp_files/figure-html/fig-tsp-model2-burma14-sol-output-2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.7: Optimal route for the <em>burma14</em> instance</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>instance <span class="op">=</span> <span class="st">'./data/tsp/ulysses22.tsp'</span></span>
<span id="cb21-2"><a href="#cb21-2"></a></span>
<span id="cb21-3"><a href="#cb21-3"></a>model_v2 <span class="op">=</span> TspModelV2()</span>
<span id="cb21-4"><a href="#cb21-4"></a>model_v2.read_inputs(instance_file<span class="op">=</span>instance)</span>
<span id="cb21-5"><a href="#cb21-5"></a>model_v2.build_model()</span>
<span id="cb21-6"><a href="#cb21-6"></a>model_v2.show_model_info()</span>
<span id="cb21-7"><a href="#cb21-7"></a>model_v2.optimize(<span class="va">False</span>)</span>
<span id="cb21-8"><a href="#cb21-8"></a>model_v2.show_opt_route()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of variables: 483
Number of constraints: 464
optimal value = 7013.0</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-tsp-model2-ulysses22-sol" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="ip-tsp_files/figure-html/fig-tsp-model2-ulysses22-sol-output-2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6.8: Optimal route for the <em>ulysses22</em> instance</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-3---single-commodity-flow" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="model-3---single-commodity-flow"><span class="header-section-number">6.5</span> Model 3 - Single Commodity Flow</h2>
</section>
<section id="model-4---two-commodity-flow" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="model-4---two-commodity-flow"><span class="header-section-number">6.6</span> Model 4 - Two Commodity Flow</h2>
</section>
<section id="model-5---multi-commodity-flow" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="model-5---multi-commodity-flow"><span class="header-section-number">6.7</span> Model 5 - Multi-Commodity Flow</h2>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-dantzig_solution_1954" class="csl-entry" role="listitem">
Dantzig, G., R. Fulkerson, and S. Johnson. 1954. <span>“Solution of a <span>Large</span>-<span>Scale</span> <span>Traveling</span>-<span>Salesman</span> <span>Problem</span>.”</span> <em>Journal of the Operations Research Society of America</em> 2 (4): 393–410. <a href="https://doi.org/10.1287/opre.2.4.393">https://doi.org/10.1287/opre.2.4.393</a>.
</div>
<div id="ref-miller_integer_1960" class="csl-entry" role="listitem">
Miller, C. E., A. W. Tucker, and R. A. Zemlin. 1960. <span>“Integer <span>Programming</span> <span>Formulation</span> of <span>Traveling</span> <span>Salesman</span> <span>Problems</span>.”</span> <em>Journal of the ACM</em> 7 (4): 326–29. <a href="https://doi.org/10.1145/321043.321046">https://doi.org/10.1145/321043.321046</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="kunlei/python-ortools-notes" data-repo-id="R_kgDOI-7w-A" data-category="General" data-category-id="DIC_kwDOI-7w-M4CVd98" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ip-jsp.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Job Shop Scheduling</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ip-cvrp.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Capacitated Vehicle Routing Problem</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>