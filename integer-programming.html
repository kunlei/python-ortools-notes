<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Practical Modeling with Google OR-Tools in Python - 4&nbsp; Integer Programming</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./column-generation.html" rel="next">
<link href="./linear-programming.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DTVHQH448R"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-DTVHQH448R', { 'anonymize_ip': true});
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: { equationNumbers: {autoNumber: "AMS"} },
        tex2jax: {inlineMath: [ ['$','$'], ["\\(","\\)"] ]}
    });
    </script>

<!-- This is what works with Quarto -->
<script>
    MathJax = {
        tex: {
            tags: 'ams'  // should be 'ams', 'none', or 'all'
        }
    };
</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Integer Programming</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Practical Modeling with Google OR-Tools in Python</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./env-setup.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environment Setup</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linear-programming.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Programming</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./integer-programming.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Integer Programming</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./column-generation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Column Generation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Summary</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#modeling-capabilities" id="toc-modeling-capabilities" class="nav-link active" data-scroll-target="#modeling-capabilities"><span class="toc-section-number">4.1</span>  Modeling Capabilities</a>
  <ul class="collapse">
  <li><a href="#declaring-integer-variables" id="toc-declaring-integer-variables" class="nav-link" data-scroll-target="#declaring-integer-variables"><span class="toc-section-number">4.1.1</span>  Declaring Integer Variables</a></li>
  <li><a href="#selecting-an-integer-solver" id="toc-selecting-an-integer-solver" class="nav-link" data-scroll-target="#selecting-an-integer-solver"><span class="toc-section-number">4.1.2</span>  Selecting an Integer Solver</a></li>
  </ul></li>
  <li><a href="#applications" id="toc-applications" class="nav-link" data-scroll-target="#applications"><span class="toc-section-number">4.2</span>  Applications</a>
  <ul class="collapse">
  <li><a href="#job-shop-scheduling-problem" id="toc-job-shop-scheduling-problem" class="nav-link" data-scroll-target="#job-shop-scheduling-problem"><span class="toc-section-number">4.2.1</span>  Job Shop Scheduling Problem</a></li>
  <li><a href="#capacitated-vehicle-routing-problem" id="toc-capacitated-vehicle-routing-problem" class="nav-link" data-scroll-target="#capacitated-vehicle-routing-problem"><span class="toc-section-number">4.2.2</span>  Capacitated Vehicle Routing Problem</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-integer" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Integer Programming</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Integer programming has a wide range of applications across various industries and domains. Some of the classical applications of integer programming include:</p>
<ul>
<li><p>Production Planning and Scheduling: Integer programming is widely used in production planning and scheduling to optimize the allocation of resources, such as machines, workers, and raw materials. It helps to minimize costs and maximize efficiency by determining the optimal production schedule.</p></li>
<li><p>Network Optimization: Integer programming is used in network optimization problems such as routing, scheduling, and allocation of resources in transportation networks, telecommunication networks, and supply chain management.</p></li>
<li><p>Facility Location: Integer programming is used in facility location problems, which involve determining the optimal location for a facility based on various factors such as demand, supply, and transportation costs. It is commonly used in logistics, transportation, and distribution industries.</p></li>
<li><p>Portfolio Optimization: Integer programming is used in finance to optimize investment portfolios, where the goal is to maximize the returns on the investment while minimizing risk.</p></li>
<li><p>Cutting Stock and Bin Packing: Integer programming is used in cutting stock and bin packing problems where items of varying sizes must be packed into containers or cut from a stock. This is commonly used in the packaging and manufacturing industries.</p></li>
<li><p>Crew Scheduling: Integer programming is used in crew scheduling problems, where the goal is to optimize the allocation of crew members to different shifts, duties, or activities. It is commonly used in industries such as airlines, railways, and public transportation.</p></li>
<li><p>Timetabling: Integer programming is used in timetabling problems such as scheduling classes, exams, and events in academic institutions. It helps to minimize scheduling conflicts and maximize resource utilization.</p></li>
</ul>
<p>This chapter explores the various methods that Google OR-Tools provides for modeling and solving (mixed) integer linear programming problems. The first step is to review the additional conditions that arise when modeling integer variables and solving integer programs. Following that, we use specific instances to demonstrate how these techniques are applied.</p>
<section id="modeling-capabilities" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="modeling-capabilities"><span class="header-section-number">4.1</span> Modeling Capabilities</h2>
<p>When modeling integer programs, there are two main tasks that require attention. The first is declaring integer variables, and the second is selecting a solver that is capable of solving integer programs.</p>
<section id="declaring-integer-variables" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="declaring-integer-variables"><span class="header-section-number">4.1.1</span> Declaring Integer Variables</h3>
<p>As reviewed in <a href="linear-programming.html"><span>Chapter&nbsp;3</span></a>, Google OR-Tools provides two options to create integer variables:</p>
<ul>
<li>The <code>Var(lb, ub, integer: bool, name)</code> function</li>
<li>The <code>IntVar(lb, ub, name)</code> function</li>
<li>The <code>Variable.SetInteger(integer: bool)</code> function</li>
</ul>
<p>In the code snippet below, we create three integer variables using all the aforementioned approaches:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ortools.linear_solver <span class="im">import</span> pywraplp</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>solver <span class="op">=</span> pywraplp.Solver.CreateSolver(<span class="st">'SCIP'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># option 1</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> solver.Var(lb<span class="op">=</span><span class="dv">0</span>, ub<span class="op">=</span><span class="dv">10</span>, integer<span class="op">=</span><span class="va">True</span>, name<span class="op">=</span><span class="st">'x'</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># option 2</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> solver.IntVar(lb<span class="op">=</span><span class="dv">10</span>, ub<span class="op">=</span><span class="dv">20</span>, name<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># option 3</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> solver.NumVar(lb<span class="op">=</span><span class="dv">0</span>, ub<span class="op">=</span><span class="fl">5.5</span>, name<span class="op">=</span><span class="st">'z'</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>z.SetInteger(integer<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can verify the types of variables <span class="math inline">\(x, y, z\)</span>:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"x is integer? </span><span class="sc">{</span>x<span class="sc">.</span>integer()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"y is integer? </span><span class="sc">{</span>y<span class="sc">.</span>integer()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"z is integer? </span><span class="sc">{</span>z<span class="sc">.</span>integer()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>x is integer? True
y is integer? True
z is integer? True</code></pre>
</div>
</div>
</section>
<section id="selecting-an-integer-solver" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="selecting-an-integer-solver"><span class="header-section-number">4.1.2</span> Selecting an Integer Solver</h3>
<p>There are several solvers available for solving integer programs, and some options include:</p>
<ul>
<li>CBC_MIXED_INTEGER_PROGRAMMING or CBC</li>
<li>BOP_INTEGER_PROGRAMMING or BOP</li>
<li>SAT_INTEGER_PROGRAMMING or SAT or CP_SAT</li>
<li>SCIP_MIXED_INTEGER_PROGRAMMING or SCIP</li>
<li>GUROBI_MIXED_INTEGER_PROGRAMMING or GUROBI or GUROBI_MIP</li>
<li>CPLEX_MIXED_INTEGER_PROGRAMMING or CPLEX or CPLEX_MIP</li>
<li>XPRESS_MIXED_INTEGER_PROGRAMMING or XPRESS or XPRESS_MIP</li>
<li>GLPK_MIXED_INTEGER_PROGRAMMING or GLPK or GLPK_MIP</li>
</ul>
<p>It’s important to note that some of these solvers are open-source, while others require a commercial license. The code block above demonstrates how to create an instance of an integer solver. To do so, we simply need to specify the name of the solver in the Solver.CreateSolver() function.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>solver <span class="op">=</span> pywraplp.Solver.CreateSolver(<span class="st">'CBC'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="applications" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="applications"><span class="header-section-number">4.2</span> Applications</h2>
<p>In this section, we use Google OR-Tools to solve some of the classical integer programming problems.</p>
<section id="job-shop-scheduling-problem" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="job-shop-scheduling-problem"><span class="header-section-number">4.2.1</span> Job Shop Scheduling Problem</h3>
<p>In the job shop scheduling problem (JSSP), there are a set of <span class="math inline">\(n\)</span> jobs <span class="math inline">\(\mathcal{J}\)</span> and a set of <span class="math inline">\(m\)</span> machines <span class="math inline">\(\mathcal{M}\)</span>, and each job <span class="math inline">\(j \in \mathcal{J}\)</span> has a list of operations, given by <span class="math inline">\((o_1^j, \cdots, o_h^j, \cdots, o_m^j)\)</span>, that must be carried on the machines. The order of operations in the list also indicates the processing order of the job, and <span class="math inline">\(o_h^j\)</span> represents the <span class="math inline">\(h\)</span>-th operation of the job <span class="math inline">\(j\)</span>. In addition, the processing time of job <span class="math inline">\(j\)</span> on machine <span class="math inline">\(i\)</span>, denoted by <span class="math inline">\(p_{ij}\)</span>, is known in advance and is a non-negative integer. At any moment of time, each machine can only process at most one job and no preemption is allowed which means that a job must completes its processing on a machine once it starts on that machine. The objective is to find a processing schedule of the jobs on the machines such that the makespan, the completion time of the last operation of any job, is minimized.</p>
<p>To test the modeling of JSSP, we use a benchmarking instance from the OR-Library (<span class="citation" data-cites="or-library">Beasley (<a href="references.html#ref-or-library" role="doc-biblioref">1990</a>)</span>), shown in the box below. The two numbers in the first line represent the number of jobs and the number of machines, respectively. Each remaining line contains the operations, processing machine and processing time, for each job. Note that the machines are numbered starting from 0.</p>
<div class="cell" data-code-block-bg="true" data-code-block-border-left="#31BAE9" data-execution_count="95">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instance ft06 from OR-Library</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 6   </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 1   0   3   1   6   3   7   5   3   4   6</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 8   2   5   4   10  5   10  0   10  3   4</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 5   3   4   5   8   0   9   1   1   4   7</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 5   0   5   2   5   3   3   4   8   5   9</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 9   1   3   4   5   5   4   0   3   3   1</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 3   3   3   5   9   0   10  4   4   2   1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Suppose this instance data is saved in a file named <em>ft06.txt</em> and the code below defines an utility function to read and parse the instance for later use.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_jssp_instance(filename: <span class="bu">str</span>):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(filename) <span class="im">as</span> f:</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>        num_jobs, num_machines <span class="op">=</span> [<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">next</span>(f).split()]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        operations <span class="op">=</span> []</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        processing_times <span class="op">=</span> {}</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        job_idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> line <span class="kw">in</span> f:</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>            info <span class="op">=</span> [<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> line.split()]</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            arr <span class="op">=</span> [info[<span class="dv">2</span> <span class="op">*</span> m] <span class="cf">for</span> m <span class="kw">in</span> <span class="bu">range</span>(num_machines)]</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>            times <span class="op">=</span> {info[<span class="dv">2</span> <span class="op">*</span> m]: info[<span class="dv">2</span> <span class="op">*</span> m <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> m <span class="kw">in</span> <span class="bu">range</span>(num_machines)}</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>            operations.append(arr)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>            processing_times[job_idx] <span class="op">=</span> times</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>            job_idx <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> num_jobs, num_machines, operations, processing_times</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We present here three classical formulations of the JSSP from the literature and implement them using Google OR-Tools.</p>
<ol type="1">
<li>Disjunctive model</li>
</ol>
<p>This model is taken from <span class="citation" data-cites="ku_mixed_2016">Ku and Beck (<a href="references.html#ref-ku_mixed_2016" role="doc-biblioref">2016</a>)</span> and <span class="citation" data-cites="manne_job-shop_1960">Manne (<a href="references.html#ref-manne_job-shop_1960" role="doc-biblioref">1960</a>)</span>. The decision variables are defined as follows:</p>
<ul>
<li><span class="math inline">\(x_{ij}\)</span>: the processing starting time of job <span class="math inline">\(j\)</span> on machine <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(z_{ijk}\)</span>: a binary variable that equals 1 if job <span class="math inline">\(j\)</span> precedes job <span class="math inline">\(k\)</span> on machine <span class="math inline">\(i\)</span></li>
</ul>
<p>The disjunctive model can then be stated as below.</p>
<p><span class="math display">\[\begin{align}
    \text{min.} &amp;\quad C_{max} \label{jsp-dis-obj}\\
    \text{s.t.} &amp;\quad x_{ij} \geq 0, \ \forall j \in \mathcal{J}, i \in \mathcal{M} \label{jsp-dis-cons1}\\
    &amp;\quad x_{o_h^j, j} \geq x_{o_{h-1}^j, j} + p_{o_{h-1}^j, j}, \ \forall j \in \mathcal{J}, h = 2, \cdots, m \label{jsp-dis-cons2}\\
    &amp;\quad x_{ij} \geq x_{ik} + p_{ik} - V \cdot z_{ijk}, \ \forall i \in \mathcal{M}, j, k \in \mathcal{J}, j &lt; k  \label{jsp-dis-cons3}\\
    &amp;\quad x_{ik} \geq x_{ij} + p_{ij} - V \cdot (1 - z_{ijk}), \ \forall i \in \mathcal{M}, j, k \in \mathcal{J}, j &lt; k  \label{jsp-dis-cons4}\\
    &amp;\quad C_{max} \geq x_{o_m^j, j} + p_{o_m^j, j}, \ \forall j \in \mathcal{J}  \label{jsp-dis-cons5}\\
    &amp;\quad z_{ijk} \in \{0, 1\}, \ \forall i \in \mathcal{M}, j, k \in \mathcal{J} \label{jsp-dis-cons6}
\end{align}\]</span></p>
<p>The objective <span class="math inline">\(\eqref{jsp-dis-obj}\)</span> aims to minimize the maximal completion time of any job <span class="math inline">\(j \in \mathcal{J}\)</span>. Constraints <span class="math inline">\(\eqref{jsp-dis-cons1}\)</span> require that all the job processing starting time must not be negative values. Constraints <span class="math inline">\(\eqref{jsp-dis-cons2}\)</span> enforce the sequencing order among operations for every job, which state that the <span class="math inline">\(h\)</span>-th operation of job <span class="math inline">\(j\)</span>, <span class="math inline">\(o_h^j\)</span>, cannot start unless its preceeding operation <span class="math inline">\(o_{h - 1}^j\)</span> finishes. Constraints <span class="math inline">\(\eqref{jsp-dis-cons3}\)</span> and <span class="math inline">\(\eqref{jsp-dis-cons4}\)</span> together make sure that at most one job can be processed on a machine at any time. To be specific, in case of job <span class="math inline">\(j\)</span> preceding job <span class="math inline">\(k\)</span> on machine <span class="math inline">\(i\)</span>, <span class="math inline">\(z_{ijk}\)</span> takes the value of 1 and constraints <span class="math inline">\(\eqref{jsp-dis-cons4}\)</span> ensure that job <span class="math inline">\(k\)</span> won’t start processing on machine <span class="math inline">\(i\)</span> unless job <span class="math inline">\(i\)</span> completes processing; Otherwise, <span class="math inline">\(z_{ijk}\)</span> takes the value of 0 and constraints <span class="math inline">\(\eqref{jsp-dis-cons3}\)</span> require that job <span class="math inline">\(j\)</span> starts processing after job <span class="math inline">\(k\)</span>. Note that both constraints are needed when we require <span class="math inline">\(j &lt; k\)</span>; Otherwise, only one of them is needed if we create a constraint for every pair of <span class="math inline">\(j\)</span> and <span class="math inline">\(k\)</span> on a machine. Constraints <span class="math inline">\(\eqref{jsp-dis-cons5}\)</span> derive <span class="math inline">\(C_{max}\)</span> across all jobs. The last constraints <span class="math inline">\(\eqref{jsp-dis-cons6}\)</span> state the variable type of <span class="math inline">\(z_{ijk}\)</span>.</p>
<p>The disjunctive formulation code is presented entirely in the following lines. The data related to the specific case are read between lines 5 to 8, and a solver object is created in line 11. The variable <span class="math inline">\(x_{ij}\)</span> is introduced in lines 16 to 23, followed by the introduction of variable <span class="math inline">\(z_{ijk}\)</span> in lines 25 to 34. The variable <span class="math inline">\(C_{max}\)</span> is defined in lines 36 to 38. The objective of the model is set in line 41, and the constraints are established in lines 44 to 80. The instance is solved, and the optimal solution is obtained from lines 82 to 93.</p>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="im">from</span> ortools.linear_solver <span class="im">import</span> pywraplp</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># read and parse the data</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>filename <span class="op">=</span> <span class="st">'./data/jssp/ft06.txt'</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>num_jobs, num_machines, <span class="op">\</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>operations, processing_times <span class="op">=</span> <span class="op">\</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>    read_jssp_instance(filename)</span>
<span id="cb7-9"><a href="#cb7-9"></a></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co"># create solver</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>solver <span class="op">=</span> pywraplp.Solver.CreateSolver(<span class="st">'SCIP'</span>)</span>
<span id="cb7-12"><a href="#cb7-12"></a></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co"># create variables</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>infinity <span class="op">=</span> solver.Infinity()</span>
<span id="cb7-15"><a href="#cb7-15"></a>var_time: List[List] <span class="op">=</span> []</span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines):</span>
<span id="cb7-17"><a href="#cb7-17"></a>    arr <span class="op">=</span> [</span>
<span id="cb7-18"><a href="#cb7-18"></a>        solver.NumVar(<span class="dv">0</span>, </span>
<span id="cb7-19"><a href="#cb7-19"></a>                    infinity, </span>
<span id="cb7-20"><a href="#cb7-20"></a>                    name<span class="op">=</span><span class="ss">f'x_</span><span class="sc">{</span>machine<span class="sc">,</span> job<span class="sc">}</span><span class="ss">'</span>) </span>
<span id="cb7-21"><a href="#cb7-21"></a>        <span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs)</span>
<span id="cb7-22"><a href="#cb7-22"></a>        ]</span>
<span id="cb7-23"><a href="#cb7-23"></a>    var_time.append(arr)</span>
<span id="cb7-24"><a href="#cb7-24"></a></span>
<span id="cb7-25"><a href="#cb7-25"></a>var_prec: Dict <span class="op">=</span> []</span>
<span id="cb7-26"><a href="#cb7-26"></a><span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines):</span>
<span id="cb7-27"><a href="#cb7-27"></a>    mac_dict <span class="op">=</span> {}</span>
<span id="cb7-28"><a href="#cb7-28"></a>    <span class="cf">for</span> job_j <span class="kw">in</span> <span class="bu">range</span>(num_jobs <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb7-29"><a href="#cb7-29"></a>        <span class="cf">for</span> job_k <span class="kw">in</span> <span class="bu">range</span>(job_j <span class="op">+</span> <span class="dv">1</span>, num_jobs):</span>
<span id="cb7-30"><a href="#cb7-30"></a>            mac_dict[(job_j, job_k)] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb7-31"><a href="#cb7-31"></a>            solver.BoolVar(</span>
<span id="cb7-32"><a href="#cb7-32"></a>                name<span class="op">=</span><span class="ss">f'z_</span><span class="sc">{</span>machine<span class="sc">,</span> job_j<span class="sc">,</span> job_k<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb7-33"><a href="#cb7-33"></a>            )</span>
<span id="cb7-34"><a href="#cb7-34"></a>    var_prec.append(mac_dict)</span>
<span id="cb7-35"><a href="#cb7-35"></a></span>
<span id="cb7-36"><a href="#cb7-36"></a>var_makespan <span class="op">=</span> solver.NumVar(<span class="dv">0</span>, </span>
<span id="cb7-37"><a href="#cb7-37"></a>                            infinity, </span>
<span id="cb7-38"><a href="#cb7-38"></a>                            name<span class="op">=</span><span class="st">'C_max'</span>)</span>
<span id="cb7-39"><a href="#cb7-39"></a></span>
<span id="cb7-40"><a href="#cb7-40"></a><span class="co"># create objective</span></span>
<span id="cb7-41"><a href="#cb7-41"></a>solver.Minimize(var_makespan)</span>
<span id="cb7-42"><a href="#cb7-42"></a></span>
<span id="cb7-43"><a href="#cb7-43"></a><span class="co"># create constraints</span></span>
<span id="cb7-44"><a href="#cb7-44"></a><span class="cf">for</span> job, job_operations <span class="kw">in</span> <span class="bu">enumerate</span>(operations):</span>
<span id="cb7-45"><a href="#cb7-45"></a>    <span class="cf">for</span> h <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, num_machines):</span>
<span id="cb7-46"><a href="#cb7-46"></a>        curr_machine <span class="op">=</span> job_operations[h]</span>
<span id="cb7-47"><a href="#cb7-47"></a>        prev_machine <span class="op">=</span> job_operations[h <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb7-48"><a href="#cb7-48"></a>        prev_time <span class="op">=</span> processing_times[job][prev_machine]</span>
<span id="cb7-49"><a href="#cb7-49"></a>        solver.Add(</span>
<span id="cb7-50"><a href="#cb7-50"></a>            var_time[curr_machine][job] <span class="op">&gt;=</span> </span>
<span id="cb7-51"><a href="#cb7-51"></a>                var_time[prev_machine][job] <span class="op">+</span> </span>
<span id="cb7-52"><a href="#cb7-52"></a>                prev_time</span>
<span id="cb7-53"><a href="#cb7-53"></a>            )</span>
<span id="cb7-54"><a href="#cb7-54"></a></span>
<span id="cb7-55"><a href="#cb7-55"></a>V <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-56"><a href="#cb7-56"></a><span class="cf">for</span> job <span class="kw">in</span> processing_times:</span>
<span id="cb7-57"><a href="#cb7-57"></a>    V <span class="op">+=</span> <span class="bu">sum</span>(processing_times[job].values())</span>
<span id="cb7-58"><a href="#cb7-58"></a><span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines):</span>
<span id="cb7-59"><a href="#cb7-59"></a>    <span class="cf">for</span> job_j <span class="kw">in</span> <span class="bu">range</span>(num_jobs <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb7-60"><a href="#cb7-60"></a>        <span class="cf">for</span> job_k <span class="kw">in</span> <span class="bu">range</span>(job_j <span class="op">+</span> <span class="dv">1</span>, num_jobs):</span>
<span id="cb7-61"><a href="#cb7-61"></a>            solver.Add(</span>
<span id="cb7-62"><a href="#cb7-62"></a>                var_time[machine][job_j] <span class="op">&gt;=</span> </span>
<span id="cb7-63"><a href="#cb7-63"></a>                var_time[machine][job_k] <span class="op">+</span></span>
<span id="cb7-64"><a href="#cb7-64"></a>                processing_times[job_k][machine] <span class="op">-</span> </span>
<span id="cb7-65"><a href="#cb7-65"></a>                V <span class="op">*</span> var_prec[machine][(job_j, job_k)]</span>
<span id="cb7-66"><a href="#cb7-66"></a>            )</span>
<span id="cb7-67"><a href="#cb7-67"></a>            solver.Add(</span>
<span id="cb7-68"><a href="#cb7-68"></a>                var_time[machine][job_k] <span class="op">&gt;=</span> </span>
<span id="cb7-69"><a href="#cb7-69"></a>                var_time[machine][job_j] <span class="op">+</span></span>
<span id="cb7-70"><a href="#cb7-70"></a>                processing_times[job_j][machine] <span class="op">-</span> </span>
<span id="cb7-71"><a href="#cb7-71"></a>                V <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> var_prec[machine][(job_j, job_k)])</span>
<span id="cb7-72"><a href="#cb7-72"></a>            )</span>
<span id="cb7-73"><a href="#cb7-73"></a>            </span>
<span id="cb7-74"><a href="#cb7-74"></a><span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs):</span>
<span id="cb7-75"><a href="#cb7-75"></a>    last_oper_machine <span class="op">=</span> operations[job][<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb7-76"><a href="#cb7-76"></a>    solver.Add(</span>
<span id="cb7-77"><a href="#cb7-77"></a>        var_makespan <span class="op">&gt;=</span> </span>
<span id="cb7-78"><a href="#cb7-78"></a>        var_time[last_oper_machine][job] <span class="op">+</span> </span>
<span id="cb7-79"><a href="#cb7-79"></a>        processing_times[job][last_oper_machine]</span>
<span id="cb7-80"><a href="#cb7-80"></a>    )</span>
<span id="cb7-81"><a href="#cb7-81"></a></span>
<span id="cb7-82"><a href="#cb7-82"></a>status <span class="op">=</span> solver.Solve()</span>
<span id="cb7-83"><a href="#cb7-83"></a></span>
<span id="cb7-84"><a href="#cb7-84"></a><span class="cf">if</span> status <span class="op">==</span> solver.OPTIMAL:</span>
<span id="cb7-85"><a href="#cb7-85"></a>    <span class="bu">print</span>(<span class="ss">f"min. makespan = </span><span class="sc">{</span>solver<span class="sc">.</span>Objective()<span class="sc">.</span>Value()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb7-86"><a href="#cb7-86"></a>    </span>
<span id="cb7-87"><a href="#cb7-87"></a>    opt_time <span class="op">=</span> []</span>
<span id="cb7-88"><a href="#cb7-88"></a>    <span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines):</span>
<span id="cb7-89"><a href="#cb7-89"></a>        arr <span class="op">=</span> [</span>
<span id="cb7-90"><a href="#cb7-90"></a>            <span class="bu">int</span>(var_time[machine][job].solution_value()) </span>
<span id="cb7-91"><a href="#cb7-91"></a>            <span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs)</span>
<span id="cb7-92"><a href="#cb7-92"></a>        ]</span>
<span id="cb7-93"><a href="#cb7-93"></a>        opt_time.append(arr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>min. makespan = 55.00</code></pre>
</div>
</div>
<p>The output of the model indicates that the lowest possible time needed to complete all tasks in this instance is 55. To illustrate the most efficient solution, we have created a function called <code>show_schedule()</code> that displays a Gantt chart of the tasks needed to process all jobs. <a href="#fig-jssp-dis-sol-ft06">Figure&nbsp;<span>4.1</span></a> displays the optimal solution for this instance.</p>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_schedule(num_jobs, operations, processing_times, opt_time):</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> mpl.colormaps[<span class="st">"Set1"</span>].colors</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>[<span class="dv">7</span>, <span class="dv">3</span>], dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, job <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">range</span>(num_jobs)):</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        machines <span class="op">=</span> operations[job]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        job_start_times <span class="op">=</span> [opt_time[machine][job] </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">for</span> machine <span class="kw">in</span> machines]</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        job_processing_times <span class="op">=</span> [processing_times[job][machine] </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">for</span> machine <span class="kw">in</span> operations[job]]</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="op">&gt;=</span> <span class="bu">len</span>(colors):</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            idx <span class="op">=</span> idx <span class="op">%</span> <span class="bu">len</span>(colors)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> colors[idx]</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        bars <span class="op">=</span> ax.barh(machines, </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                width<span class="op">=</span>job_processing_times, </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                left<span class="op">=</span>job_start_times, </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="ss">f'Job </span><span class="sc">{</span>job <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>, </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span>color)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        ax.bar_label(bars, </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                    fmt<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>job <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>, </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                    label_type<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(machines)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"Time"</span>)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">"Machine"</span>)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    fig.tight_layout()</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>show_schedule(num_jobs, operations, processing_times, opt_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-jssp-dis-sol-ft06" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="integer-programming_files/figure-html/fig-jssp-dis-sol-ft06-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.1: Optimal solution of the ft06 instance using the disjunctive formulation</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Time-indexed model</li>
</ol>
<p>The time-indexed formulation, proposed by <span class="citation" data-cites="kondili_general_1988">Kondili, Pantelides, and Sargent (<a href="references.html#ref-kondili_general_1988" role="doc-biblioref">1988</a>)</span> and <span class="citation" data-cites="ku_mixed_2016">Ku and Beck (<a href="references.html#ref-ku_mixed_2016" role="doc-biblioref">2016</a>)</span>, involves the use of a binary variable <span class="math inline">\(x_{ijt}\)</span> that takes the value of 1 if job <span class="math inline">\(j\)</span> starts at time <span class="math inline">\(t\)</span> on machine <span class="math inline">\(i\)</span>. The model can be expressed as follows.</p>
<p><span class="math display">\[\begin{align}
\text{min.} &amp;\quad C_{max} \label{jsp-time-obj}\\
\text{s.t.} &amp;\quad \sum_{t \in H} x_{ijt} = 1, \ \forall j \in \mathcal{J}, i \in \mathcal{M} \label{jsp-time-cons1} \\
&amp;\quad \sum_{t \in H} (t + p_{ij}) \cdot x_{ijt} \leq C_{max}, \ \forall j \in \mathcal{J}, i \in \mathcal{M} \label{jsp-time-cons2} \\
&amp;\quad \sum_{j \in \mathcal{J}} \sum_{t' \in T_{ijt}} x_{ijt'} \leq 1, \ \forall i \in \mathcal{M}, t \in H, T_{ijt} = \{t - p_{ij} + 1, \cdots, t\} \label{jsp-time-cons3} \\
&amp;\quad \sum_{t \in H} (t + p_{o_{h - 1}^j}, j) \cdot x_{o_{h - 1}^j, jt} \leq \sum_{t \in H} t \cdot x_{o_h^j, jt}, \ \forall j \in \mathcal{J}, h = 2, \cdots, m \label{jsp-time-cons4} \\
&amp;\quad x_{ijt} \in \{0, 1\}, \ \forall j \in \mathcal{J}, i \in \mathcal{M}, t \in H \label{jsp-time-cons5}
\end{align}\]</span></p>
<p>In this formulation, the first set of constraints, referred to as <span class="math inline">\(\eqref{jsp-time-cons1}\)</span>, state that each job <span class="math inline">\(j\)</span> must start at one specific time within the scheduling horizon <span class="math inline">\(H\)</span>, which is determined as the sum of processing times for all jobs - <span class="math inline">\(H = \sum_{i \in \mathcal{I}, j \in \mathcal{J}} p_{ij}\)</span>. Constraints <span class="math inline">\(\eqref{jsp-time-cons2}\)</span> are used to calculate the value of <span class="math inline">\(C_{max}\)</span>, while constraints <span class="math inline">\(\eqref{jsp-time-cons3}\)</span> ensure that only one job can be processed by a machine at any given time. It’s important to note that a job will remain on a machine for its full processing time and cannot be interrupted. Constraints <span class="math inline">\(\eqref{jsp-time-cons4}\)</span> make sure that the order of processing jobs is followed, and constraints <span class="math inline">\(\eqref{jsp-time-cons5}\)</span> define the variable types used in the formulation.</p>
<p>The following code provides a program that uses the time-indexed formulation to solve the <code>ft06</code> instance, with the value of <span class="math inline">\(H\)</span> being the sum of all job processing times plus one. The two variables, <span class="math inline">\(x_{ijt}\)</span> and <span class="math inline">\(C_{max}\)</span>, are created in lines 18 - 27. The constraints are created in lines 33 - 57. The optimal solution is retrieved in lines 61 - 71. It can be seen from the output that the same optimal objective, 55, is obtained using this formulation.</p>
<div class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="im">from</span> ortools.linear_solver <span class="im">import</span> pywraplp</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co"># read and parse the data</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>filename <span class="op">=</span> <span class="st">'./data/jssp/ft06.txt'</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>num_jobs, num_machines, <span class="op">\</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>operations, processing_times <span class="op">=</span> <span class="op">\</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>    read_jssp_instance(filename)</span>
<span id="cb10-10"><a href="#cb10-10"></a>    </span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co"># create solver</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>solver <span class="op">=</span> pywraplp.Solver.CreateSolver(<span class="st">'SCIP'</span>)</span>
<span id="cb10-13"><a href="#cb10-13"></a></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co"># create variables</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>H <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="cf">for</span> job <span class="kw">in</span> processing_times:</span>
<span id="cb10-17"><a href="#cb10-17"></a>    H <span class="op">+=</span> <span class="bu">sum</span>(processing_times[job].values())</span>
<span id="cb10-18"><a href="#cb10-18"></a>var_x <span class="op">=</span> np.empty((num_machines, num_jobs, H), dtype<span class="op">=</span><span class="bu">object</span>)</span>
<span id="cb10-19"><a href="#cb10-19"></a><span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines):</span>
<span id="cb10-20"><a href="#cb10-20"></a>    <span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs):</span>
<span id="cb10-21"><a href="#cb10-21"></a>        <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(H):</span>
<span id="cb10-22"><a href="#cb10-22"></a>            var_x[machine][job][t] <span class="op">=</span> solver.BoolVar(name<span class="op">=</span><span class="ss">f'x_</span><span class="sc">{</span>machine<span class="sc">,</span> job<span class="sc">,</span> t<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb10-23"><a href="#cb10-23"></a></span>
<span id="cb10-24"><a href="#cb10-24"></a>infinity <span class="op">=</span> solver.Infinity()</span>
<span id="cb10-25"><a href="#cb10-25"></a>var_makespan <span class="op">=</span> solver.NumVar(<span class="dv">0</span>, </span>
<span id="cb10-26"><a href="#cb10-26"></a>                            infinity, </span>
<span id="cb10-27"><a href="#cb10-27"></a>                            name<span class="op">=</span><span class="st">'C_max'</span>)</span>
<span id="cb10-28"><a href="#cb10-28"></a></span>
<span id="cb10-29"><a href="#cb10-29"></a><span class="co"># create objective</span></span>
<span id="cb10-30"><a href="#cb10-30"></a>solver.Minimize(var_makespan)</span>
<span id="cb10-31"><a href="#cb10-31"></a></span>
<span id="cb10-32"><a href="#cb10-32"></a><span class="co"># create constraints</span></span>
<span id="cb10-33"><a href="#cb10-33"></a><span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines):</span>
<span id="cb10-34"><a href="#cb10-34"></a>    <span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs):</span>
<span id="cb10-35"><a href="#cb10-35"></a>        solver.Add(solver.Sum([var_x[machine][job][t] <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(H)]) <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb10-36"><a href="#cb10-36"></a>        </span>
<span id="cb10-37"><a href="#cb10-37"></a><span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines):</span>
<span id="cb10-38"><a href="#cb10-38"></a>    <span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs):</span>
<span id="cb10-39"><a href="#cb10-39"></a>        arr <span class="op">=</span> [var_x[machine][job][t] <span class="op">*</span> (t <span class="op">+</span> processing_times[job][machine]) <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(H)]</span>
<span id="cb10-40"><a href="#cb10-40"></a>        solver.Add(solver.Sum(arr) <span class="op">&lt;=</span> var_makespan)</span>
<span id="cb10-41"><a href="#cb10-41"></a>        </span>
<span id="cb10-42"><a href="#cb10-42"></a><span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines):</span>
<span id="cb10-43"><a href="#cb10-43"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(H):</span>
<span id="cb10-44"><a href="#cb10-44"></a>        arr <span class="op">=</span> [var_x[machine][job][tt]</span>
<span id="cb10-45"><a href="#cb10-45"></a>                    <span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs)</span>
<span id="cb10-46"><a href="#cb10-46"></a>                    <span class="cf">for</span> tt <span class="kw">in</span> <span class="bu">range</span>(t <span class="op">-</span> processing_times[job][machine] <span class="op">+</span> <span class="dv">1</span>, t <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb10-47"><a href="#cb10-47"></a>        solver.Add(solver.Sum(arr) <span class="op">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb10-48"><a href="#cb10-48"></a></span>
<span id="cb10-49"><a href="#cb10-49"></a><span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs):</span>
<span id="cb10-50"><a href="#cb10-50"></a>    <span class="cf">for</span> oper <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, num_machines):</span>
<span id="cb10-51"><a href="#cb10-51"></a>        prev_machine <span class="op">=</span> operations[job][oper <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb10-52"><a href="#cb10-52"></a>        curr_machine <span class="op">=</span> operations[job][oper]</span>
<span id="cb10-53"><a href="#cb10-53"></a>        expr_prev <span class="op">=</span> [(t <span class="op">+</span> processing_times[job][prev_machine]) <span class="op">*</span> var_x[prev_machine][job][t] </span>
<span id="cb10-54"><a href="#cb10-54"></a>                    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(H)]</span>
<span id="cb10-55"><a href="#cb10-55"></a>        expr_curr <span class="op">=</span> [t <span class="op">*</span> var_x[curr_machine][job][t]</span>
<span id="cb10-56"><a href="#cb10-56"></a>                    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(H)]</span>
<span id="cb10-57"><a href="#cb10-57"></a>        solver.Add(solver.Sum(expr_prev) <span class="op">&lt;=</span> solver.Sum(expr_curr))</span>
<span id="cb10-58"><a href="#cb10-58"></a></span>
<span id="cb10-59"><a href="#cb10-59"></a>status <span class="op">=</span> solver.Solve()</span>
<span id="cb10-60"><a href="#cb10-60"></a></span>
<span id="cb10-61"><a href="#cb10-61"></a><span class="cf">if</span> status <span class="op">==</span> solver.OPTIMAL:</span>
<span id="cb10-62"><a href="#cb10-62"></a>    <span class="bu">print</span>(<span class="ss">f"min. makespan = </span><span class="sc">{</span>solver<span class="sc">.</span>Objective()<span class="sc">.</span>Value()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb10-63"><a href="#cb10-63"></a>    </span>
<span id="cb10-64"><a href="#cb10-64"></a>    opt_time <span class="op">=</span> []</span>
<span id="cb10-65"><a href="#cb10-65"></a>    <span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines):</span>
<span id="cb10-66"><a href="#cb10-66"></a>        arr <span class="op">=</span> []</span>
<span id="cb10-67"><a href="#cb10-67"></a>        <span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs):</span>
<span id="cb10-68"><a href="#cb10-68"></a>            <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(t):</span>
<span id="cb10-69"><a href="#cb10-69"></a>                <span class="cf">if</span> <span class="bu">int</span>(var_x[machine][job][t].solution_value()) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb10-70"><a href="#cb10-70"></a>                    arr.append(t)</span>
<span id="cb10-71"><a href="#cb10-71"></a>        opt_time.append(arr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>min. makespan = 55.00</code></pre>
</div>
</div>
<p>The optimal solution can be seen in <a href="#fig-jssp-time-sol-ft06">Figure&nbsp;<span>4.2</span></a>. Even though both formulations achieve the same optimal objective value, there are some minor discrepancies between the optimal solutions. For instance, in <a href="#fig-jssp-dis-sol-ft06">Figure&nbsp;<span>4.1</span></a>, there is a gap after job 4 completes processing on machine 3, which is not present in <a href="#fig-jssp-time-sol-ft06">Figure&nbsp;<span>4.2</span></a>.</p>
<div class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>show_schedule(num_jobs, operations, processing_times, opt_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-jssp-time-sol-ft06" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="integer-programming_files/figure-html/fig-jssp-time-sol-ft06-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.2: Optimal solution of the ft06 instance using the time-indexed formulation</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Rank-based model</li>
</ol>
<p>The rank-based model is due to <span class="citation" data-cites="wagner_integer_1959">Wagner (<a href="references.html#ref-wagner_integer_1959" role="doc-biblioref">1959</a>)</span> and taken from <span class="citation" data-cites="ku_mixed_2016">Ku and Beck (<a href="references.html#ref-ku_mixed_2016" role="doc-biblioref">2016</a>)</span>. There are three decision variables in this formulation:</p>
<ul>
<li><span class="math inline">\(x_{ijk}\)</span>: a binary variable that equals 1 if job <span class="math inline">\(j\)</span> is scheduled at the <span class="math inline">\(k\)</span>-th position on machine <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(h_{ik}\)</span>: a numerical variable that represents the start time of job at the <span class="math inline">\(k\)</span>-th position of machine <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(C_{max}\)</span>: the makespan to be minimized</li>
</ul>
<p>The complete model is given below.</p>
<p><span class="math display">\[\begin{align}
\text{min.} &amp;\quad C_{max} \label{jsp-rank-obj} \\
\text{s.t.} &amp;\quad \sum_{j \in \mathcal{J}} x_{ijk} = 1, \ \forall i \in \mathcal{M}, k = 1, \cdots, n \label{jsp-rank-cons1} \\
&amp;\quad \sum_{k = 1}^n x_{ijk} = 1, \ \forall i \in \mathcal{M}, j \in \mathcal{J} \label{jsp-rank-cons2} \\
&amp;\quad h_{ik} + \sum_{j \in \mathcal{J}} p_{ij} x_{ijk} \leq h_{i,k+1}, \ \forall i \in \mathcal{M}, k = 1, \cdots, n-1 \label{jsp-rank-cons3}\\
&amp;\quad
\begin{split}
    &amp;\sum_{i \in \mathcal{M}} r_{ijl} h_{ik} + \sum_{i \in \mathcal{M}} r_{ijl}p_{ij} \leq V \cdot (1 - \sum_{i \in \mathcal{M}}r_{ijl}x_{ijk})\  +\  \\
    &amp;V \cdot (1 - \sum_{i \in \mathcal{M}}r_{ij,l+1}x_{ijk'}) + \sum_{i \in \mathcal{M}}r_{ij,l+1}h_{ik'},\\
    &amp;\forall j \in \mathcal{J}, k, k' = 1, \cdots, n, l = 1, \cdots, m - 1
\end{split}
\label{jsp-rank-cons4}\\
&amp;\quad h_{in} + \sum_{j \in \mathcal{J}} p_{ij}x_{ijk} \leq C_{max}, \ \forall i \in \mathcal{M} \label{jsp-rank-cons5}\\
&amp;\quad h_{ik} \geq 0, \ \forall i \in \mathcal{M}, k = 1, \cdots, n \label{jsp-rank-cons6} \\
&amp;\quad x_{ijk} \in \{0, 1\}, \ \forall j \in \mathcal{J}, i \in \mathcal{M}, k = 1, \cdots, n \label{jsp-rank-cons7}\\
&amp;\quad C_{max} \geq 0 \label{jsp-rank-cons8}
\end{align}\]</span></p>
<p>In this formulation, constraints <span class="math inline">\(\eqref{jsp-rank-cons1}\)</span> make sure that there is only one job assigned to a particular rank <span class="math inline">\(k\)</span> on machine <span class="math inline">\(i\)</span>. Constraints <span class="math inline">\(\eqref{jsp-rank-cons2}\)</span> ensure that any job <span class="math inline">\(j\)</span> is assigned to one and only one rank on a machine <span class="math inline">\(i\)</span>. Constraints <span class="math inline">\(\eqref{jsp-rank-cons3}\)</span> require that a machine can only process at most one job at any point of time. Constraints <span class="math inline">\(\eqref{jsp-rank-cons4}\)</span> guarantee that the processing order of a job is respected. Constraints <span class="math inline">\(\eqref{jsp-rank-cons5}\)</span> computes the makespan. The remaining constraints <span class="math inline">\(\eqref{jsp-rank-cons6}\)</span>, <span class="math inline">\(\eqref{jsp-rank-cons7}\)</span> and <span class="math inline">\(\eqref{jsp-rank-cons8}\)</span> indicate the variable types.</p>
<p>We now solve the same problem instance using this rank-based formulation in Google OR-Tools, for which the complete code is shown below.</p>
<div class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="im">from</span> typing <span class="im">import</span> List</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="im">from</span> ortools.linear_solver <span class="im">import</span> pywraplp</span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co"># read and parse the data</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>filename <span class="op">=</span> <span class="st">'./data/jssp/ft06.txt'</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>num_jobs, num_machines, <span class="op">\</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>operations, processing_times <span class="op">=</span> <span class="op">\</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>    read_jssp_instance(filename)</span>
<span id="cb13-11"><a href="#cb13-11"></a>    </span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co"># create solver</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>solver <span class="op">=</span> pywraplp.Solver.CreateSolver(<span class="st">'SCIP'</span>)</span>
<span id="cb13-14"><a href="#cb13-14"></a></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="co"># create variables</span></span>
<span id="cb13-16"><a href="#cb13-16"></a>var_x <span class="op">=</span> np.empty(shape<span class="op">=</span>(num_machines, num_jobs, num_jobs), dtype<span class="op">=</span><span class="bu">object</span>)</span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="cf">for</span> machine, job, rank <span class="kw">in</span> product(<span class="bu">range</span>(num_machines), </span>
<span id="cb13-18"><a href="#cb13-18"></a>                                <span class="bu">range</span>(num_jobs), </span>
<span id="cb13-19"><a href="#cb13-19"></a>                                <span class="bu">range</span>(num_jobs)):</span>
<span id="cb13-20"><a href="#cb13-20"></a>    var_x[machine][job][rank] <span class="op">=</span> solver.BoolVar(name<span class="op">=</span><span class="ss">f'x_</span><span class="sc">{</span>machine<span class="sc">,</span> job<span class="sc">,</span> rank<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb13-21"><a href="#cb13-21"></a>            </span>
<span id="cb13-22"><a href="#cb13-22"></a></span>
<span id="cb13-23"><a href="#cb13-23"></a>infinity <span class="op">=</span> solver.Infinity()</span>
<span id="cb13-24"><a href="#cb13-24"></a>var_h <span class="op">=</span> np.empty(shape<span class="op">=</span>(num_machines, num_jobs), dtype<span class="op">=</span><span class="bu">object</span>)</span>
<span id="cb13-25"><a href="#cb13-25"></a><span class="cf">for</span> machine, rank <span class="kw">in</span> product(<span class="bu">range</span>(num_machines), <span class="bu">range</span>(num_jobs)):</span>
<span id="cb13-26"><a href="#cb13-26"></a>    var_h[machine][rank] <span class="op">=</span> solver.NumVar(<span class="dv">0</span>, infinity, name<span class="op">=</span><span class="ss">f'h_</span><span class="sc">{</span>machine<span class="sc">,</span> rank<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb13-27"><a href="#cb13-27"></a></span>
<span id="cb13-28"><a href="#cb13-28"></a>var_makespan <span class="op">=</span> solver.NumVar(<span class="dv">0</span>, infinity, name<span class="op">=</span><span class="ss">f'makesplan'</span>)</span>
<span id="cb13-29"><a href="#cb13-29"></a></span>
<span id="cb13-30"><a href="#cb13-30"></a><span class="co"># create objective</span></span>
<span id="cb13-31"><a href="#cb13-31"></a>solver.Minimize(var_makespan)</span>
<span id="cb13-32"><a href="#cb13-32"></a></span>
<span id="cb13-33"><a href="#cb13-33"></a><span class="co"># create constraints</span></span>
<span id="cb13-34"><a href="#cb13-34"></a><span class="cf">for</span> machine, rank <span class="kw">in</span> product(<span class="bu">range</span>(num_machines), <span class="bu">range</span>(num_jobs)):</span>
<span id="cb13-35"><a href="#cb13-35"></a>    expr <span class="op">=</span> [var_x[machine][job][rank] <span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs)]</span>
<span id="cb13-36"><a href="#cb13-36"></a>    solver.Add(solver.Sum(expr) <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb13-37"><a href="#cb13-37"></a></span>
<span id="cb13-38"><a href="#cb13-38"></a><span class="cf">for</span> machine, job <span class="kw">in</span> product(<span class="bu">range</span>(num_machines), <span class="bu">range</span>(num_jobs)):</span>
<span id="cb13-39"><a href="#cb13-39"></a>    expr <span class="op">=</span> [var_x[machine][job][rank] <span class="cf">for</span> rank <span class="kw">in</span> <span class="bu">range</span>(num_jobs)]</span>
<span id="cb13-40"><a href="#cb13-40"></a>    solver.Add(solver.Sum(expr) <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb13-41"><a href="#cb13-41"></a></span>
<span id="cb13-42"><a href="#cb13-42"></a><span class="cf">for</span> machine, rank <span class="kw">in</span> product(<span class="bu">range</span>(num_machines), <span class="bu">range</span>(num_jobs <span class="op">-</span> <span class="dv">1</span>)):</span>
<span id="cb13-43"><a href="#cb13-43"></a>    expr <span class="op">=</span> [var_x[machine][job][rank] <span class="op">*</span> processing_times[job][machine] </span>
<span id="cb13-44"><a href="#cb13-44"></a>            <span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs)]</span>
<span id="cb13-45"><a href="#cb13-45"></a>    solver.Add(var_h[machine][rank] <span class="op">+</span> solver.Sum(expr) <span class="op">&lt;=</span> var_h[machine][rank <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb13-46"><a href="#cb13-46"></a></span>
<span id="cb13-47"><a href="#cb13-47"></a>r <span class="op">=</span> np.zeros((num_machines, num_jobs, num_machines))</span>
<span id="cb13-48"><a href="#cb13-48"></a><span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs):</span>
<span id="cb13-49"><a href="#cb13-49"></a>    job_operations: List <span class="op">=</span> operations[job]</span>
<span id="cb13-50"><a href="#cb13-50"></a>    <span class="cf">for</span> o_idx, o_machine <span class="kw">in</span> <span class="bu">enumerate</span>(job_operations):</span>
<span id="cb13-51"><a href="#cb13-51"></a>        r[o_machine][job][o_idx] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb13-52"><a href="#cb13-52"></a>V <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-53"><a href="#cb13-53"></a><span class="cf">for</span> job <span class="kw">in</span> processing_times:</span>
<span id="cb13-54"><a href="#cb13-54"></a>    V <span class="op">+=</span> <span class="bu">sum</span>(processing_times[job].values())</span>
<span id="cb13-55"><a href="#cb13-55"></a></span>
<span id="cb13-56"><a href="#cb13-56"></a><span class="cf">for</span> job, k, kk, l <span class="kw">in</span> product(<span class="bu">range</span>(num_jobs), </span>
<span id="cb13-57"><a href="#cb13-57"></a>                            <span class="bu">range</span>(num_jobs), </span>
<span id="cb13-58"><a href="#cb13-58"></a>                            <span class="bu">range</span>(num_jobs), </span>
<span id="cb13-59"><a href="#cb13-59"></a>                            <span class="bu">range</span>(num_machines <span class="op">-</span> <span class="dv">1</span>)):</span>
<span id="cb13-60"><a href="#cb13-60"></a>    expr_1 <span class="op">=</span> [r[machine][job][l] <span class="op">*</span> var_h[machine][k] </span>
<span id="cb13-61"><a href="#cb13-61"></a>            <span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines)]</span>
<span id="cb13-62"><a href="#cb13-62"></a>    expr_2 <span class="op">=</span> [r[machine][job][l] <span class="op">*</span> processing_times[job][machine]</span>
<span id="cb13-63"><a href="#cb13-63"></a>            <span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines)]</span>
<span id="cb13-64"><a href="#cb13-64"></a>    expr_3 <span class="op">=</span> [r[machine][job][l] <span class="op">*</span> var_x[machine][job][k]</span>
<span id="cb13-65"><a href="#cb13-65"></a>            <span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines)]</span>
<span id="cb13-66"><a href="#cb13-66"></a>    expr_4 <span class="op">=</span> [r[machine][job][l <span class="op">+</span> <span class="dv">1</span>] <span class="op">*</span> var_x[machine][job][kk] </span>
<span id="cb13-67"><a href="#cb13-67"></a>            <span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines)]</span>
<span id="cb13-68"><a href="#cb13-68"></a>    expr_5 <span class="op">=</span> [r[machine][job][l <span class="op">+</span> <span class="dv">1</span>] <span class="op">*</span> var_h[machine][kk] </span>
<span id="cb13-69"><a href="#cb13-69"></a>            <span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines)]</span>
<span id="cb13-70"><a href="#cb13-70"></a>    solver.Add(solver.Sum(expr_1) <span class="op">+</span> solver.Sum(expr_2) <span class="op">&lt;=</span> V <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> solver.Sum(expr_3)) <span class="op">+</span> V <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> solver.Sum(expr_4)) <span class="op">+</span> solver.Sum(expr_5))</span>
<span id="cb13-71"><a href="#cb13-71"></a></span>
<span id="cb13-72"><a href="#cb13-72"></a><span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines):</span>
<span id="cb13-73"><a href="#cb13-73"></a>    expr <span class="op">=</span> [var_x[machine][job][num_jobs <span class="op">-</span> <span class="dv">1</span>] <span class="op">*</span> processing_times[job][machine] <span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs)]</span>
<span id="cb13-74"><a href="#cb13-74"></a>    solver.Add(var_h[machine][num_jobs <span class="op">-</span> <span class="dv">1</span>] <span class="op">+</span> solver.Sum(expr) <span class="op">&lt;=</span> var_makespan)</span>
<span id="cb13-75"><a href="#cb13-75"></a></span>
<span id="cb13-76"><a href="#cb13-76"></a>status <span class="op">=</span> solver.Solve()</span>
<span id="cb13-77"><a href="#cb13-77"></a></span>
<span id="cb13-78"><a href="#cb13-78"></a><span class="cf">if</span> status <span class="op">==</span> pywraplp.Solver.OPTIMAL:</span>
<span id="cb13-79"><a href="#cb13-79"></a>    <span class="bu">print</span>(<span class="ss">f"opt_obj = </span><span class="sc">{</span>solver<span class="sc">.</span>Objective()<span class="sc">.</span>Value()<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb13-80"><a href="#cb13-80"></a>    opt_time <span class="op">=</span> []</span>
<span id="cb13-81"><a href="#cb13-81"></a>    <span class="cf">for</span> machine <span class="kw">in</span> <span class="bu">range</span>(num_machines):</span>
<span id="cb13-82"><a href="#cb13-82"></a>        arr <span class="op">=</span> []</span>
<span id="cb13-83"><a href="#cb13-83"></a>        <span class="cf">for</span> job <span class="kw">in</span> <span class="bu">range</span>(num_jobs):</span>
<span id="cb13-84"><a href="#cb13-84"></a>            <span class="cf">for</span> rank <span class="kw">in</span> <span class="bu">range</span>(num_jobs):</span>
<span id="cb13-85"><a href="#cb13-85"></a>                <span class="cf">if</span> <span class="bu">int</span>(var_x[machine][job][rank].solution_value()) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb13-86"><a href="#cb13-86"></a>                    arr.append(var_h[machine][rank].solution_value())</span>
<span id="cb13-87"><a href="#cb13-87"></a>        opt_time.append(arr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>opt_obj = 55.0000</code></pre>
</div>
</div>
<p><a href="#fig-jssp-rank-sol-ft06">Figure&nbsp;<span>4.3</span></a> displays the optimal solution obtained by utilizing the rank-based model. Upon careful examination, it is slightly distinct from the optimal solutions produced by the disjunctive model and the time-indexed model. Nevertheless, all three models achieve the same objective value of 55.</p>
<div class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>show_schedule(num_jobs, operations, processing_times, opt_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-jssp-rank-sol-ft06" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="integer-programming_files/figure-html/fig-jssp-rank-sol-ft06-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.3: Optional solution found by the rank-based model for instance ft06</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>While this book does not aim to compare the performance of the three modeling approaches, <a href="#tbl-jssp-data">Table&nbsp;<span>4.1</span></a> presents the computational times required by each formulation to discover the optimal solutions. The table indicates that the disjunctive model is the most efficient of the three, followed by the time-indexed model, while the rank-based model requires the longest time to converge. It should be noted that making a conclusion about the performance of these models based on one experimental run on a single instance is insufficient.</p>
<div class="cell" data-execution_count="158">
<div class="cell-output cell-output-display" data-execution_count="158">
<div id="tbl-jssp-data" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;4.1: Computational time comparison of the three formulations</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Instance</th>
<th style="text-align: left;">Disjunctive Model</th>
<th style="text-align: left;">Time-indexed Model</th>
<th style="text-align: left;">Rank-based Model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ft06</td>
<td style="text-align: left;">1.7s</td>
<td style="text-align: left;">1m34.9s</td>
<td style="text-align: left;">11m38.2s</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="capacitated-vehicle-routing-problem" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="capacitated-vehicle-routing-problem"><span class="header-section-number">4.2.2</span> Capacitated Vehicle Routing Problem</h3>
<p>The Capacitated Vehicle Routing Problem (CVRP) is a classical combinatorial optimization problem that involves finding the optimal set of routes for a fleet of vehicles to deliver goods or services to a set of customers. In the CVRP, a set of customers is given, each with a known demand and location. A fleet of vehicles, each with a limited capacity, is available to serve these customers. The problem is to find a set of routes visited by the vehicles such that each customer is visited once and only once and the total traveling distance is minimized.</p>
<p>We use the notation provided in <span class="citation" data-cites="toth_vehicle_2014">Toth and Vigo (<a href="references.html#ref-toth_vehicle_2014" role="doc-biblioref">2014</a>)</span> to facilitate the presentation of different CVRP models. The depot, denoted as 0, serves as the starting point for transporting goods to customers in <span class="math inline">\(\mathcal{N} = {1, 2, \cdots, n}\)</span> using a homogeneous fleet <span class="math inline">\(\mathcal{K} = {1, 2, \cdots, |\mathcal{K}|}\)</span>. Each customer in <span class="math inline">\(\mathcal{N}\)</span> has a demand of <span class="math inline">\(q_i \geq 0\)</span>, and each vehicle has a positive capacity of <span class="math inline">\(Q &gt; 0\)</span>. The cost of transportation, denoted by <span class="math inline">\(c_{ij}\)</span>, is incurred when a vehicle travels between <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>. A vehicle’s route begins at the depot, visits some or all the customers in <span class="math inline">\(\mathcal{N}\)</span>, and then returns to the depot. The objective is to determine the optimal set of routes for the fleet to minimize the total cost of transportation.</p>
<p>The CVRP could be defined on a directed graph <span class="math inline">\(\mathcal{G} = (\mathcal{V}, \mathcal{A})\)</span>, where <span class="math inline">\(\mathcal{V} = \{0\} \cup \{1, 2, \cdots, n\} = \{0, 1, \cdots, n\}\)</span>, and <span class="math inline">\(\mathcal{A} = \{(i, j) | i, j \in \mathcal{V}, i \neq j\}\)</span>. Let <span class="math inline">\(S\)</span> be a subset of <span class="math inline">\(\mathcal{V}\)</span>, that is, <span class="math inline">\(S \subseteq \mathcal{V}\)</span>. The in-arcs and out-arcs of <span class="math inline">\(S\)</span> are defined as follows:</p>
<ul>
<li><span class="math inline">\(\delta^-(S) = \{(i, j) \in \mathcal{A} | i \notin S, j \in S \}\)</span></li>
<li><span class="math inline">\(\delta^+(S) = \{(i, j) \in \mathcal{A} | i \in S, j \notin S \}\)</span></li>
</ul>
<p>In addition, we use <span class="math inline">\(\mathcal{A}(S) = \{(i, j) \in \mathcal{A} | i \in S, j \in S \}\)</span> to indicate all the arcs that connect nodes within <span class="math inline">\(S\)</span>.</p>
<section id="cvrp-instances" class="level4" data-number="4.2.2.1">
<h4 data-number="4.2.2.1" class="anchored" data-anchor-id="cvrp-instances"><span class="header-section-number">4.2.2.1</span> CVRP Instances</h4>
<p>We use the instances taken from <span class="citation" data-cites="cvrplib">CVRPLIB (<a href="references.html#ref-cvrplib" role="doc-biblioref">2014</a>)</span> to illustrate the modeling and solving process with Google OR-Tools. <span class="citation" data-cites="cvrplib">CVRPLIB (<a href="references.html#ref-cvrplib" role="doc-biblioref">2014</a>)</span> contains many benchmarking instances for CVRP and we use the python package <code>vrplib</code> to load the instance <code>P-n16-k8.vrp</code> and its optimal solution <code>P-n16-k8.sol</code>.</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install vrplib with command: pip install vrplib</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> vrplib</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read VRPLIB formatted instances (default)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>instance <span class="op">=</span> vrplib.read_instance(<span class="st">"./data/cvrp/P-n16-k8.vrp"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>solution <span class="op">=</span> vrplib.read_solution(<span class="st">"./data/cvrp/P-n16-k8.sol"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s first create a function to visualize vehicle routes, as given below.</p>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_vehicle_routes(locations, edges):</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""draw vehicles routings</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">    adapted from https://stackoverflow.com/a/50682819</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">    examples:</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">    locations = {</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">        0: (5, 5),</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">        1: (4, 9),</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">        2: (6, 4),</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">        3: (2, 6),</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">    }</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co">    edges = [</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">        (0, 1, {'vehicle': '0'}),</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co">        (1, 2, {'vehicle': '0'}),</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co">        (2, 0, {'vehicle': '0'}),</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co">        (0, 3, {'vehicle': '1'}),</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co">        (3, 0, {'vehicle': '1'}),</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co">    ]</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co">        locations (dict): location id -&gt; (lat, lon)</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co">        edges (list): list of edges</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> nx.DiGraph()</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    G.add_edges_from(edges)</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    vehicles <span class="op">=</span> <span class="bu">set</span>([e[<span class="dv">2</span>][<span class="st">'vehicle'</span>] <span class="cf">for</span> e <span class="kw">in</span> edges])</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    num_vehicles <span class="op">=</span> <span class="bu">len</span>(vehicles)</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> mpl.colormaps[<span class="st">"Set1"</span>].colors</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">range</span>(num_vehicles):</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> [e <span class="cf">for</span> e <span class="kw">in</span> edges <span class="cf">if</span> e[<span class="dv">2</span>][<span class="st">'vehicle'</span>] <span class="op">==</span> <span class="bu">str</span>(v)]</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>        color_idx <span class="op">=</span> v </span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> color_idx <span class="op">&gt;=</span> <span class="bu">len</span>(colors):</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>            color_idx <span class="op">=</span> color_idx <span class="op">%</span> <span class="bu">len</span>(colors)</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> np.array([colors[color_idx]])</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>        nx.draw_networkx_nodes(G, </span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>                                locations, </span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>                                nodelist<span class="op">=</span>[x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> temp], </span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>                                node_color<span class="op">=</span>color)</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>        nx.draw_networkx_edges(G,</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>                                locations, </span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>                                edgelist<span class="op">=</span>temp,</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>                                width<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>                                edge_color<span class="op">=</span>color, </span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>                                style<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">#let's color the node 0 in black</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>    nx.draw_networkx_nodes(G, locations, </span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>                            nodelist<span class="op">=</span>[<span class="dv">0</span>], </span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>                            node_color<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># labels</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>    nx.draw_networkx_labels(G, locations, </span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>                            font_color<span class="op">=</span><span class="st">'w'</span>, </span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>                            font_size<span class="op">=</span><span class="dv">12</span>, </span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>                            font_family<span class="op">=</span><span class="st">'sans-serif'</span>)</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print out the graph</span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#fig-cvrp-p-n16-k6-sol">Figure&nbsp;<span>4.4</span></a> shows the optimal vehicle routes for the instance P-n16-k8.vrp.</p>
<div class="cell" data-execution_count="72">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the optimal solution</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>node_coords <span class="op">=</span> instance[<span class="st">'node_coord'</span>]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>locations <span class="op">=</span> {}</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, coord <span class="kw">in</span> <span class="bu">enumerate</span>(node_coords):</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    locations[idx] <span class="op">=</span> (coord[<span class="dv">0</span>], coord[<span class="dv">1</span>])</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>routes <span class="op">=</span> solution[<span class="st">'routes'</span>]</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>vehicle_idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> []</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> route <span class="kw">in</span> routes:</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    r_temp <span class="op">=</span> route.copy()</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    r_temp.insert(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    r_temp.insert(<span class="bu">len</span>(r_temp), <span class="dv">0</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(r_temp) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        edges.append((r_temp[i], r_temp[i <span class="op">+</span> <span class="dv">1</span>], {<span class="st">'vehicle'</span>: <span class="bu">str</span>(vehicle_idx)}))</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    vehicle_idx <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>show_vehicle_routes(locations, edges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-cvrp-p-n16-k6-sol" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="integer-programming_files/figure-html/fig-cvrp-p-n16-k6-sol-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.4: Optimal routes for instance P-n16-k8.vrp</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="two-index-formulation" class="level4" data-number="4.2.2.2">
<h4 data-number="4.2.2.2" class="anchored" data-anchor-id="two-index-formulation"><span class="header-section-number">4.2.2.2</span> Two-index Formulation</h4>
<p>This formulation was proposed by <span class="citation" data-cites="laporte_exact_1986">Laporte, Mercure, and Nobert (<a href="references.html#ref-laporte_exact_1986" role="doc-biblioref">1986</a>)</span> and we present the formulation given in <span class="citation" data-cites="toth_vehicle_2014">Toth and Vigo (<a href="references.html#ref-toth_vehicle_2014" role="doc-biblioref">2014</a>)</span>. In this formulation, we define the variable <span class="math inline">\(x_{ij}\)</span> that equals 1 if the arc <span class="math inline">\((i, j)\)</span> is traversed by a vehicle. The complete model is given below.</p>
<p><span class="math display">\[\begin{align}
    \text{min.} &amp;\quad \sum_{(i, j) \in \mathcal{A}} c_{ij} x_{ij} \label{cvrp-two-index-obj} \\
    \text{s.t.} &amp;\quad \sum_{j \in \delta^+(i)}x_{ij} = 1, \ \forall i \in \mathcal{N} \label
    {cvrp-two-index-cons1}\\
    &amp;\quad \sum_{i \in \delta^-(j)} x_{ij} = 1, \ \forall j \in \mathcal{N} \label{cvrp-two-index-cons2} \\
    &amp;\quad \sum_{j \in \delta^+(0)} x_{oj} = |\mathcal{K}| \label{cvrp-two-index-cons3} \\
    &amp;\quad \sum_{(i, j) \in \delta^+(S)} x_{ij} \geq r(S), \ \forall S \subseteq \mathcal{N}, S \neq \emptyset \label{cvrp-two-index-cons4} \\
    &amp;\quad x_{ij} \in \{0, 1\}, \ \forall (i, j) \in \mathcal{A} \label{cvrp-two-index-cons5}
\end{align}\]</span></p>
<p>The objective function represented by equation <span class="math inline">\(\eqref{cvrp-two-index-obj}\)</span> is to minimize the overall transportation costs. The constraints expressed in equations <span class="math inline">\(\eqref{cvrp-two-index-cons1}\)</span> and <span class="math inline">\(\eqref{cvrp-two-index-cons2}\)</span> work together to guarantee that each customer is visited only once, with one incoming and outgoing arc. Constraints <span class="math inline">\(\eqref{cvrp-two-index-cons3}\)</span> ensure that all available vehicles are utilized to serve the customers. Constraints <span class="math inline">\(\eqref{cvrp-two-index-cons4}\)</span> prevent the formation of sub-tours. Finally, the variable types are defined by the last set of constraints, which are presented in equation <span class="math inline">\(\eqref{cvrp-two-index-cons5}\)</span>.</p>
<p>To solve the aforementioned instance, we’ll first prepare the data for our following implementation use. Let’s first define two classes, <code>Node</code> and <code>Vehicle</code>, to represent a node in the network and the vechiles, respectively.</p>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""a node is either a depot (0) or a customer</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, <span class="bu">id</span>, x_coord, y_coord, demand):</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._id <span class="op">=</span> <span class="bu">id</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._x_coord <span class="op">=</span> x_coord</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._y_coord <span class="op">=</span> y_coord</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._demand <span class="op">=</span> demand</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">id</span>(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._id</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> x_coord(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._x_coord</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> y_coord(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._y_coord</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> demand(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._demand</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"id: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_id<span class="sc">}</span><span class="ss">, x_coord: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_x_coord<span class="sc">}</span><span class="ss">, y_coord: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_y_coord<span class="sc">}</span><span class="ss">, demand: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_demand<span class="sc">}</span><span class="ss">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Vehicle:</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""a vehicle</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, <span class="bu">id</span>, capacity):</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._id <span class="op">=</span> <span class="bu">id</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._capacity <span class="op">=</span> capacity</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="bu">id</span>(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._id</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> capacity(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>._capacity</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"id: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_id<span class="sc">}</span><span class="ss">, capacity: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>_capacity<span class="sc">}</span><span class="ss">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s define a function to read in the VRP instance and create a list of nodes and vehicles for later use.</p>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> vrplib</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_cvrp_instance(instance_file):</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    instance <span class="op">=</span> vrplib.read_instance(instance_file)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># gather nodes</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    nodes <span class="op">=</span> []</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node, demand <span class="kw">in</span> <span class="bu">zip</span>(instance[<span class="st">'node_coord'</span>], instance[<span class="st">'demand'</span>]):</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> Node(<span class="bu">id</span><span class="op">=</span>idx, x_coord<span class="op">=</span>node[<span class="dv">0</span>], y_coord<span class="op">=</span>node[<span class="dv">1</span>], demand<span class="op">=</span>demand)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        nodes.append(node)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># gather vechiles</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    comment <span class="op">=</span> instance[<span class="st">'comment'</span>]</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    num_vehicles <span class="op">=</span> <span class="bu">int</span>(re.search(<span class="vs">r'\d'</span>, comment).group())</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    vehicles <span class="op">=</span> []</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">range</span>(num_vehicles):</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>        vehicle <span class="op">=</span> Vehicle(v, <span class="bu">int</span>(instance[<span class="st">'capacity'</span>]))</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>        vehicles.append(vehicle)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># gather distance matrix</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    distance <span class="op">=</span> instance[<span class="st">'edge_weight'</span>]</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nodes, vehicles, distance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To implement this formulation using Google OR-Tools, we first create a <code>solver</code> object with solver option <code>SCIP</code> to solve mixed integer programming problems.</p>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ortools.linear_solver <span class="im">import</span> pywraplp</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>solver <span class="op">=</span> pywraplp.Solver.CreateSolver(<span class="st">'SCIP'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s create the decision variable <span class="math inline">\(x_{ij}\)</span>.</p>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>nodes, vehicles, distance <span class="op">=</span> read_cvrp_instance(<span class="st">"./data/cvrp/P-n16-k8.vrp"</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>num_nodes <span class="op">=</span> <span class="bu">len</span>(nodes)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>num_vehicles <span class="op">=</span> <span class="bu">len</span>(vehicles)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>var_x <span class="op">=</span> np.empty((num_nodes, num_nodes), dtype<span class="op">=</span><span class="bu">object</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, j <span class="kw">in</span> product(<span class="bu">range</span>(num_nodes), <span class="bu">range</span>(num_nodes)):</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    var_x[i][j] <span class="op">=</span> solver.BoolVar(name<span class="op">=</span><span class="st">"x_{i, j}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we create the objective function.</p>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>obj_expr <span class="op">=</span> [</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    distance[i][j] <span class="op">*</span> var_x[i][j]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, j <span class="kw">in</span> product(<span class="bu">range</span>(num_nodes), <span class="bu">range</span>(num_nodes))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>solver.Minimize(solver.Sum(obj_expr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we create the constraints <span class="math inline">\(\eqref{cvrp-two-index-cons1}\)</span> and <span class="math inline">\(\eqref{cvrp-two-index-cons2}\)</span>.</p>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, num_nodes):</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    out_arcs <span class="op">=</span> [var_x[i][j] <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(num_nodes)]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    in_arcs <span class="op">=</span> [var_x[j][i] <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(num_nodes)]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    solver.Add(solver.Sum(out_arcs) <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    solver.Add(solver.Sum(in_arcs) <span class="op">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Constraints <span class="math inline">\(\eqref{cvrp-two-index-cons3}\)</span> is created as follows.</p>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>expr <span class="op">=</span> [var_x[<span class="dv">0</span>][i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, num_nodes)]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>solver.Add(solver.Sum(expr) <span class="op">==</span> num_vehicles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>&lt;ortools.linear_solver.pywraplp.Constraint; proxy of &lt;Swig Object of type 'operations_research::MPConstraint *' at 0x11e14b090&gt; &gt;</code></pre>
</div>
</div>
<p>To create the subtour elimination constraints <span class="math inline">\(\eqref{cvrp-two-index-cons4}\)</span>, we first need to enumerate all the non-empty subset of <span class="math inline">\(\mathcal{N}\)</span>.</p>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> combinations</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_all_combinations(numbers):</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    combs <span class="op">=</span> []</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(numbers) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>        combs.extend(<span class="bu">list</span>(combinations(numbers, i)))</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> combs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>node_ids <span class="op">=</span> [node.<span class="bu">id</span> <span class="cf">for</span> node <span class="kw">in</span> nodes]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>id_combinations <span class="op">=</span> get_all_combinations(node_ids)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>id_combinations</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> comb <span class="kw">in</span> id_combinations:</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    others <span class="op">=</span> <span class="bu">set</span>(node_ids).difference(comb)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    expr <span class="op">=</span> [var_x[i][j]</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> comb</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> others]</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    solver.Add(solver.Sum(expr) <span class="op">&gt;=</span> <span class="bu">len</span>(comb))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>status <span class="op">=</span> solver.Solve()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(solver.Objective().Value())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>WARNING: Logging before InitGoogleLogging() is written to STDERR
E0330 09:08:23.255555     1 linear_solver.cc:1899] No solution exists. MPSolverInterface::result_status_ = MPSOLVER_INFEASIBLE</code></pre>
</div>
</div>
</section>
<section id="three-index-formulation" class="level4" data-number="4.2.2.3">
<h4 data-number="4.2.2.3" class="anchored" data-anchor-id="three-index-formulation"><span class="header-section-number">4.2.2.3</span> Three-index Formulation</h4>
</section>
<section id="commodity-flow-formulation" class="level4" data-number="4.2.2.4">
<h4 data-number="4.2.2.4" class="anchored" data-anchor-id="commodity-flow-formulation"><span class="header-section-number">4.2.2.4</span> Commodity-flow Formulation</h4>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-or-library" class="csl-entry" role="doc-biblioentry">
Beasley, John E. 1990. <span>“OR-Library: Distributing Test Problems by Electronic Mail.”</span> <em>Journal of the Operational Research Society</em> 41 (11): 1069–72.
</div>
<div id="ref-cvrplib" class="csl-entry" role="doc-biblioentry">
CVRPLIB. 2014. <span>“<span>CVRPLIB</span>.”</span> <a href="http://vrp.galgos.inf.puc-rio.br/index.php/en/">http://vrp.galgos.inf.puc-rio.br/index.php/en/</a>.
</div>
<div id="ref-kondili_general_1988" class="csl-entry" role="doc-biblioentry">
Kondili, E, CC Pantelides, and R WH Sargent. 1988. <span>“A <span>General</span> <span>Algorithm</span> for <span>Scheduling</span> <span>Batch</span> <span>Operations</span>.”</span> In. Barton, ACT. <a href="https://search.informit.org/doi/10.3316/informit.394925233030714">https://search.informit.org/doi/10.3316/informit.394925233030714</a>.
</div>
<div id="ref-ku_mixed_2016" class="csl-entry" role="doc-biblioentry">
Ku, Wen-Yang, and J. Christopher Beck. 2016. <span>“Mixed <span>Integer</span> <span>Programming</span> Models for Job Shop Scheduling: <span>A</span> Computational Analysis.”</span> <em>Computers &amp; Operations Research</em> 73 (September): 165–73. <a href="https://doi.org/10.1016/j.cor.2016.04.006">https://doi.org/10.1016/j.cor.2016.04.006</a>.
</div>
<div id="ref-laporte_exact_1986" class="csl-entry" role="doc-biblioentry">
Laporte, Gilbert, Hélène Mercure, and Yves Nobert. 1986. <span>“An Exact Algorithm for the Asymmetrical Capacitated Vehicle Routing Problem.”</span> <em>Networks</em> 16 (1): 33–46. <a href="https://doi.org/10.1002/net.3230160104">https://doi.org/10.1002/net.3230160104</a>.
</div>
<div id="ref-manne_job-shop_1960" class="csl-entry" role="doc-biblioentry">
Manne, Alan S. 1960. <span>“On the <span>Job</span>-<span>Shop</span> <span>Scheduling</span> <span>Problem</span>.”</span> <em>Operations Research</em> 8 (2): 219–23. <a href="https://doi.org/10.1287/opre.8.2.219">https://doi.org/10.1287/opre.8.2.219</a>.
</div>
<div id="ref-toth_vehicle_2014" class="csl-entry" role="doc-biblioentry">
Toth, Paolo, and Daniele Vigo. 2014. <em>Vehicle Routing: Problems, Methods, and Applications</em>. SIAM.
</div>
<div id="ref-wagner_integer_1959" class="csl-entry" role="doc-biblioentry">
Wagner, Harvey M. 1959. <span>“An Integer Linear-Programming Model for Machine Scheduling.”</span> <em>Naval Research Logistics Quarterly</em> 6 (2): 131–40. <a href="https://doi.org/10.1002/nav.3800060205">https://doi.org/10.1002/nav.3800060205</a>.
</div>
</div>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./linear-programming.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Programming</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./column-generation.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Column Generation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>